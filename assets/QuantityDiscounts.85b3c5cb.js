import{r as l,ao as V,aU as j,j as c,b as r}from"./index.4f23c09f.js";import{m as G}from"./ProductApi.ec9e3999.js";import{C as N}from"./index.cffb9cfd.js";import{F as s}from"./index.87e32118.js";import{I as g}from"./index.334a4467.js";import{S as y}from"./index.421566c6.js";import{B as b}from"./button.0e0bb488.js";import{T as U}from"./Table.7ae9acac.js";import"./apiConfig.6fee151b.js";import"./axios.0a901153.js";import"./config.93562c2e.js";import"./render.a21f8e67.js";import"./useNotification.ddc3cd5c.js";import"./useMutation.esm.62dcf3b9.js";import"./utils.esm.958af8f4.js";import"./useInfiniteQuery.esm.7b143079.js";import"./useQuery.esm.48f464b8.js";import"./Dropdown.af716b86.js";import"./useMergedState.a9c803d6.js";import"./Overflow.1804b708.js";import"./index.04eab99a.js";import"./motion.9212238f.js";import"./isEqual.5405dd52.js";import"./PlusOutlined.1693ec3e.js";import"./index.7a8128c4.js";import"./collapse.7fea9198.js";import"./LoadingOutlined.ad18cc7b.js";import"./row.dbcb11e5.js";import"./useFlexGapSupport.3166aa6c.js";import"./responsiveObserve.16c01648.js";import"./index.2687a7e4.js";import"./Compact.8d51645f.js";import"./TextArea.5556322f.js";import"./statusUtils.c3240a4a.js";import"./EyeOutlined.ac35e31d.js";import"./SearchOutlined.19f92cba.js";import"./pickAttrs.08767335.js";import"./CheckOutlined.a5fb0c39.js";import"./DownOutlined.72f23fd5.js";import"./PurePanel.01378a58.js";import"./styleChecker.c75b564a.js";import"./css.d6e3059f.js";import"./Pagination.61534547.js";import"./LeftOutlined.04d83dae.js";import"./RightOutlined.dab7e2a3.js";import"./useForceUpdate.f84be2ca.js";import"./index.9fb36eb2.js";import"./index.48a55223.js";import"./dropdown.c5450427.js";import"./index.c1ec313f.js";const O="_discount_container_k3ru9_3",R="_discount_container_left_k3ru9_11",z="_discount_container_right_k3ru9_29",B="_new_add_btn_k3ru9_43",u={discount_container:O,discount_container_left:R,discount_container_right:z,new_add_btn:B},E={0:"All",1:"Guest",2:"Registered user"},ze=({id:p,price_data:t})=>{const[_,f]=l.exports.useState([]),[x,w]=l.exports.useState("A"),[m,a]=l.exports.useState([]),[C,d]=l.exports.useState([]),{isLoading:v,mutate:S}=G(),k=V(),I=j();let D=t==null?void 0:t.prices;const A=e=>{let o=x=="A"?{...e,price:e.value}:{...e,percentage_discount:e.value,price:t==null?void 0:t.price},i={prices:t==null?void 0:t.prices.map(n=>n.percentage_discount=="0"?{...n}:{...n,price:t==null?void 0:t.price}).concat(o)};h(p,i)};l.exports.useEffect(()=>{const e=Object.values(t==null?void 0:t.prices).map((o,i)=>({...o,key:i,type:o.percentage_discount=="0"?"Absolute":"Percentage",user_group:E[o.usergroup_id]}));f(e),d(t==null?void 0:t.prices)},[t]);const h=(e,o)=>{S({data:o,id:e},{onSuccess:i=>{k.invalidateQueries(["single_product",e]),a([])},onError:i=>console.log("Something went wrong,",i)})},F=e=>{e.price_type&&w(e.price_type)},L=e=>{let i=[...D].filter((n,Q)=>!e.includes(Q));d({prices:i.map(n=>n.percentage_discount=="0"?{...n}:{...n,price:t==null?void 0:t.price})})},P={selectedRowKeys:m,onChange:e=>{L(e),a(e)},getCheckboxProps:e=>({disabled:e.key===0,name:e.lower_limit})},T=m.length>0,q=[{title:"Quantity",dataIndex:"lower_limit",key:"product"},{title:"Value",dataIndex:"price",key:"price",render:(e,o)=>r("div",{children:(o==null?void 0:o.percentage_discount)=="0"?parseFloat(o.price).toFixed(2):o.percentage_discount+"%"})},{title:"Discounted amount/item",dataIndex:"price",key:"price",render:e=>r("div",{children:parseFloat(e).toFixed(2)})},{title:"Type",dataIndex:"type",key:"amount"},{title:"User Group",key:"action",dataIndex:"user_group"}];return c("div",{className:u.quantity_discount,children:[r(N,{children:r(s,{name:"basic",layout:"vertical",initialValues:{price_type:"A",usergroup_id:"0"},onFinish:A,autoComplete:"off",onValuesChange:F,children:c("div",{className:u.discount_container,children:[c("div",{className:u.discount_container_left,children:[r(s.Item,{label:"Quantity",name:"lower_limit",style:{width:"80px"},rules:[{required:!0,message:""}],children:r(g,{type:"number"})}),r(s.Item,{label:"Value",name:"value",rules:[{required:!0,message:""}],children:r(g,{type:"number"})}),r(s.Item,{label:"Type",name:"price_type",style:{width:"200px"},children:r(y,{showArrow:!0,optionFilterProp:"children",filterOption:(e,o)=>{var i;return((i=o==null?void 0:o.label)!=null?i:"").toLowerCase().includes(e.toLowerCase())},options:[{value:"A",label:"Absolute(\u0930\u0941)"},{value:"P",label:"Percent(%)"}]})}),r(s.Item,{label:"User group",name:"usergroup_id",style:{width:"200px"},children:r(y,{showArrow:!0,optionFilterProp:"children",filterOption:(e,o)=>{var i;return((i=o==null?void 0:o.label)!=null?i:"").toLowerCase().includes(e.toLowerCase())},options:[{value:"0",label:"All"},{value:"1",label:"Guest"},{value:"2",label:"Registered user"}]})})]}),r("div",{className:u.discount_container_right,children:r(s.Item,{children:r(b,{type:"primary",htmlType:"submit",children:"Save"})})})]})})}),r("div",{style:{backgroundColor:"white",padding:"10px"},children:r(b,{type:"primary",disabled:!T,onClick:()=>h(p,C),children:"Delete"})}),r(U,{id:"product",loading:v,columns:q,dataSource:_,pagination:!1,rowSelection:P,scroll:{y:I.height>670?300:200,x:1e3}})]})};export{ze as default};
