import{r as l,ao as V,aU as j,j as c,b as r}from"./index.0eae6df2.js";import{m as G}from"./ProductApi.1a51d991.js";import{C as N}from"./index.1b605c09.js";import{F as s}from"./index.9a251b5a.js";import{I as g}from"./index.e0155dc4.js";import{S as y}from"./index.c17da8cc.js";import{B as b}from"./button.bb92e4e7.js";import{T as U}from"./Table.c3ea0e52.js";import"./apiConfig.422f7f8e.js";import"./axios.0a901153.js";import"./config.a608364a.js";import"./render.36f71972.js";import"./useNotification.b0fd12ef.js";import"./useMutation.esm.b9a3c183.js";import"./utils.esm.9d23a50b.js";import"./useInfiniteQuery.esm.39b60b71.js";import"./useQuery.esm.a226e4a2.js";import"./Dropdown.a44dcf86.js";import"./useMergedState.e128dcb1.js";import"./Overflow.0bb1c80c.js";import"./index.00b7436e.js";import"./motion.25de7d91.js";import"./isEqual.7557051f.js";import"./PlusOutlined.bcf114a1.js";import"./index.a53e5976.js";import"./collapse.d7e28f1d.js";import"./LoadingOutlined.8c764613.js";import"./row.cc463873.js";import"./useFlexGapSupport.26f67e3e.js";import"./responsiveObserve.b22e885b.js";import"./index.ae11ed19.js";import"./Compact.394e1fff.js";import"./TextArea.79f23aac.js";import"./statusUtils.bdd687b0.js";import"./EyeOutlined.e2533ce1.js";import"./SearchOutlined.83cc36da.js";import"./pickAttrs.8c22c2db.js";import"./CheckOutlined.aebd02a2.js";import"./DownOutlined.0d88a6a7.js";import"./PurePanel.6b30b4ea.js";import"./styleChecker.c2755425.js";import"./css.d6e3059f.js";import"./Pagination.e850c34f.js";import"./LeftOutlined.3acbf618.js";import"./RightOutlined.44374471.js";import"./useForceUpdate.36181d63.js";import"./index.db80b566.js";import"./index.ed0030b1.js";import"./dropdown.04f8b523.js";import"./index.7079f3c0.js";const O="_discount_container_k3ru9_3",R="_discount_container_left_k3ru9_11",z="_discount_container_right_k3ru9_29",B="_new_add_btn_k3ru9_43",u={discount_container:O,discount_container_left:R,discount_container_right:z,new_add_btn:B},E={0:"All",1:"Guest",2:"Registered user"},ze=({id:p,price_data:t})=>{const[_,f]=l.exports.useState([]),[x,w]=l.exports.useState("A"),[m,a]=l.exports.useState([]),[C,d]=l.exports.useState([]),{isLoading:v,mutate:S}=G(),k=V(),I=j();let D=t==null?void 0:t.prices;const A=e=>{let o=x=="A"?{...e,price:e.value}:{...e,percentage_discount:e.value,price:t==null?void 0:t.price},i={prices:t==null?void 0:t.prices.map(n=>n.percentage_discount=="0"?{...n}:{...n,price:t==null?void 0:t.price}).concat(o)};h(p,i)};l.exports.useEffect(()=>{const e=Object.values(t==null?void 0:t.prices).map((o,i)=>({...o,key:i,type:o.percentage_discount=="0"?"Absolute":"Percentage",user_group:E[o.usergroup_id]}));f(e),d(t==null?void 0:t.prices)},[t]);const h=(e,o)=>{S({data:o,id:e},{onSuccess:i=>{k.invalidateQueries(["single_product",e]),a([])},onError:i=>console.log("Something went wrong,",i)})},F=e=>{e.price_type&&w(e.price_type)},L=e=>{let i=[...D].filter((n,Q)=>!e.includes(Q));d({prices:i.map(n=>n.percentage_discount=="0"?{...n}:{...n,price:t==null?void 0:t.price})})},P={selectedRowKeys:m,onChange:e=>{L(e),a(e)},getCheckboxProps:e=>({disabled:e.key===0,name:e.lower_limit})},T=m.length>0,q=[{title:"Quantity",dataIndex:"lower_limit",key:"product"},{title:"Value",dataIndex:"price",key:"price",render:(e,o)=>r("div",{children:(o==null?void 0:o.percentage_discount)=="0"?parseFloat(o.price).toFixed(2):o.percentage_discount+"%"})},{title:"Discounted amount/item",dataIndex:"price",key:"price",render:e=>r("div",{children:parseFloat(e).toFixed(2)})},{title:"Type",dataIndex:"type",key:"amount"},{title:"User Group",key:"action",dataIndex:"user_group"}];return c("div",{className:u.quantity_discount,children:[r(N,{children:r(s,{name:"basic",layout:"vertical",initialValues:{price_type:"A",usergroup_id:"0"},onFinish:A,autoComplete:"off",onValuesChange:F,children:c("div",{className:u.discount_container,children:[c("div",{className:u.discount_container_left,children:[r(s.Item,{label:"Quantity",name:"lower_limit",style:{width:"80px"},rules:[{required:!0,message:""}],children:r(g,{type:"number"})}),r(s.Item,{label:"Value",name:"value",rules:[{required:!0,message:""}],children:r(g,{type:"number"})}),r(s.Item,{label:"Type",name:"price_type",style:{width:"200px"},children:r(y,{showArrow:!0,optionFilterProp:"children",filterOption:(e,o)=>{var i;return((i=o==null?void 0:o.label)!=null?i:"").toLowerCase().includes(e.toLowerCase())},options:[{value:"A",label:"Absolute(\u0930\u0941)"},{value:"P",label:"Percent(%)"}]})}),r(s.Item,{label:"User group",name:"usergroup_id",style:{width:"200px"},children:r(y,{showArrow:!0,optionFilterProp:"children",filterOption:(e,o)=>{var i;return((i=o==null?void 0:o.label)!=null?i:"").toLowerCase().includes(e.toLowerCase())},options:[{value:"0",label:"All"},{value:"1",label:"Guest"},{value:"2",label:"Registered user"}]})})]}),r("div",{className:u.discount_container_right,children:r(s.Item,{children:r(b,{type:"primary",htmlType:"submit",children:"Save"})})})]})})}),r("div",{style:{backgroundColor:"white",padding:"10px"},children:r(b,{type:"primary",disabled:!T,onClick:()=>h(p,C),children:"Delete"})}),r(U,{id:"product",loading:v,columns:q,dataSource:_,pagination:!1,rowSelection:P,scroll:{y:I.height>670?300:200,x:1e3}})]})};export{ze as default};
