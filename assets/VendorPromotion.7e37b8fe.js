import{r as n,ao as k,b as r,a$ as F,j as u,X as J,v as Q}from"./index.774ea3ea.js";import{s as c}from"./Promotion.module.b34b1af2.js";import q from"./General.52710b76.js";import{g as z,h as L}from"./PromotionApi.cd0a94ff.js";import R from"./Conditions.a0a297b9.js";import W from"./Bonuses.380fcbb8.js";import{B as S}from"./Breadcrumb.97460a59.js";import{B as X}from"./button.1c6eda25.js";import{m as Y}from"./index.5b8b5984.js";import"./quill.snow.fbe9aed7.js";import"./isEqual.4659e5de.js";import"./ImageUploaderForPromotion.3d7599a4.js";import"./index.2fdd8f43.js";import"./index.26751f43.js";import"./motion.300408ad.js";import"./useMergedState.18b5b371.js";import"./collapse.bedc836d.js";import"./LoadingOutlined.732e1375.js";import"./row.114180a0.js";import"./useFlexGapSupport.f6cd5e9f.js";import"./responsiveObserve.84e4b503.js";import"./index.e54b3f24.js";import"./pickAttrs.087993c3.js";import"./useForceUpdate.0ca03680.js";import"./EyeOutlined.700862bb.js";import"./progress.df7fd1dd.js";import"./CheckOutlined.70cf6153.js";import"./index.d924cf53.js";import"./render.66f9535e.js";import"./index.5f886e53.js";import"./PlusOutlined.4da0bfe2.js";import"./index.39e4b2c8.js";import"./index.0d78aa55.js";import"./Compact.c162d62d.js";import"./TextArea.119a5545.js";import"./index.40d7e5d1.js";import"./statusUtils.d5af00d6.js";import"./SearchOutlined.16cec939.js";import"./useNotification.934e0e3b.js";import"./apiConfig.2a32373e.js";import"./axios.0a901153.js";import"./config.54eb1656.js";import"./useMutation.esm.c151e619.js";import"./utils.esm.82fab7d4.js";import"./useInfiniteQuery.esm.23b2a444.js";import"./useQuery.esm.ae6f238b.js";import"./index.esm.4a6b1e11.js";import"./Table.41afa7f4.js";import"./styleChecker.bcd3295e.js";import"./css.d6e3059f.js";import"./index.f4539c3d.js";import"./Overflow.bc908490.js";import"./DownOutlined.719ce519.js";import"./PurePanel.f27248d0.js";import"./Pagination.43e6bda7.js";import"./LeftOutlined.de95bfb5.js";import"./RightOutlined.e389cfa8.js";import"./index.23d5fe28.js";import"./index.15a5cbb2.js";import"./dropdown.adcd444c.js";import"./Dropdown.9bafc5f9.js";import"./index.4645b33d.js";import"./apicall.886edec7.js";import"./useDebounce.1afc85d0.js";const po=({data:t})=>{const[d,j]=n.exports.useState("General"),[C,g]=n.exports.useState([]),[D,x]=n.exports.useState([]),[f,w]=n.exports.useState(""),[h,$]=n.exports.useState({image_id:"",pair_id:"",object_type:"promotion"}),[m,b]=n.exports.useState({zone:"catalog",name:"",detailed_description:"",short_description:"",from_date:"",to_date:"",priority:0,stop_other_rules:"N",status:"A"}),[a,N]=n.exports.useState({set:"all",set_value:1}),{isLoading:G,mutate:T,isError:H}=z(),{mutateAsync:P}=L(),A=k(),E=()=>{switch(d){case"General":return r(q,{image:f,setImage:w,generalData:m,setGeneralData:b,data:t,deleteImage:h,setDeleteImage:$});case"Conditions":return r(R,{conditions:D,setConditions:x,conditionValues:a,setConditionValues:N});default:return r(W,{bonuses:C,setBonuses:g})}},B=e=>{const o=new Date(parseInt(e)*1e3);var s=String(o.getUTCMonth()+1).padStart(2,"0"),p=String(o.getUTCDate()).padStart(2,"0"),l=o.getUTCFullYear();return`${l}-${s}-${p}`},M=()=>{try{if(m.name){const e=new FormData;let o={promo_main_image_data:{0:{pair_id:"",type:"M",object_id:"0",image_alt:""}},file_promo_main_image_icon:{0:"promo_main"},type_promo_main_image_icon:{0:"local"},is_high_res_promo_main_image_icon:{0:"N"}},s=D.reduce((i,v,y)=>(i[y+1]={...v},i),{}),p=C.reduce((i,v,y)=>(i[y]={...v},i),{}),l={promotion_id:t==null?void 0:t.promotion_id,promotion_data:{...m,from_date:I(m.from_date),to_date:I(m.to_date),bonuses:{...p},conditions:{...a,conditions:{...s}}}};f&&(e.append("file",f),l={...l,...o}),e.append("promotion_data",JSON.stringify(l)),h.image_id&&P(h,{onSuccess:i=>console.log("image deleted successfully")}),T(e,{onSuccess:i=>{A.invalidateQueries(["single_promotion",t==null?void 0:t.promotion_id])},onError:i=>{console.log("error on updating promotion, ",i)}})}else Y.error("Name is necessary to create a promotion.")}catch(e){console.log(e.message)}};n.exports.useEffect(()=>{O(t),U(t),V(t),_(t)},[t]);const O=e=>{let o={...m};o.name=e==null?void 0:e.name,o.detailed_description=e==null?void 0:e.detailed_description,o.short_description=e==null?void 0:e.short_description,o.from_date=B(e==null?void 0:e.from_date),o.to_date=B(e==null?void 0:e.to_date),o.priority=e==null?void 0:e.priority,o.stop_other_rules=e==null?void 0:e.stop_other_rules,b(o)},U=e=>{var o;x(e!=null&&e.conditions.length?[]:Object.values((o=e==null?void 0:e.conditions)==null?void 0:o.conditions))},V=e=>{var s,p;let o={...a};o.set=(s=e==null?void 0:e.conditions)==null?void 0:s.set,o.set_value=(p=e==null?void 0:e.conditions)==null?void 0:p.set_value,N(o)},_=e=>{g(e!=null&&e.bonuses.length?Object.values(e==null?void 0:e.bonuses):[])},I=e=>{if(e){let o=e.split("-");return`${o[2]}/${o[1]}/${o[0]}`}};return G?r(F,{}):u(J.Fragment,{children:[u("div",{className:c.breadcrumb,children:[u(S,{children:[r(S.Item,{children:"Marketing"}),r(S.Item,{children:r("a",{href:"",children:"Edit Catalog Promotion"})})]}),r(X,{onClick:M,type:"primary",children:"Save changes"})]}),u("div",{className:c.container,children:[r("div",{className:c.tabWrapper,children:["General","Conditions","Bonuses"].map((e,o)=>r("div",{className:Q(c.tab,e===d?c.bgColor:null),onClick:()=>j(e),children:e},o))}),r("div",{className:c.tabcontain,children:E()})]})]})};export{po as default};
