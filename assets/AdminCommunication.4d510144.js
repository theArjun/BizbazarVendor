import{r,ao as R,a as z,b as e,b0 as D,j as n,bq as G}from"./index.2fea9b70.js";import{r as J,s as V}from"./index.b4aaa82a.js";import{d as Y,u as K}from"./MessageCenterApi.a9c88777.js";import{u as U}from"./useDebounce.857d1c38.js";import{F as a}from"./index.45329f15.js";import{B as A}from"./button.8d7ffa1a.js";import{B as c}from"./Breadcrumb.37de7763.js";import{M as W}from"./index.452d91e1.js";import{I as S}from"./index.d50c1940.js";import{n as I}from"./config.42e56451.js";import"./apiConfig.eaaa62ce.js";import"./axios.0a901153.js";import"./useInfiniteQuery.esm.f9f05d77.js";import"./useQuery.esm.8aa31306.js";import"./utils.esm.061cfd12.js";import"./useMutation.esm.8bfe2ba0.js";import"./index.de03715e.js";import"./motion.cd9ea6a7.js";import"./isEqual.cc883666.js";import"./useMergedState.acd959e8.js";import"./collapse.3b35c5c9.js";import"./LoadingOutlined.3aeec88a.js";import"./row.7750d1e9.js";import"./useFlexGapSupport.a59bf389.js";import"./responsiveObserve.6b5848d4.js";import"./Compact.c7a1bef5.js";import"./dropdown.0343149c.js";import"./RightOutlined.19164f95.js";import"./Dropdown.1d3385b2.js";import"./Overflow.1e0ec03a.js";import"./index.f5b4f9b0.js";import"./PurePanel.7897ccec.js";import"./DownOutlined.653e5bd2.js";import"./render.a8adff37.js";import"./index.d768f20b.js";import"./pickAttrs.18ca283f.js";import"./index.90d07be9.js";import"./TextArea.38af062b.js";import"./statusUtils.ab87837f.js";import"./EyeOutlined.b9911e82.js";import"./SearchOutlined.3b0489e1.js";import"./useNotification.7663c963.js";const X="_top_nav_6pkgw_1",Z="_new_add_btn_6pkgw_9",p={top_nav:X,new_add_btn:Z},{TextArea:$}=S,{id:ee}=JSON.parse(localStorage.getItem("userinfo")),l={thread:{object_type:"",object_id:0,communication_type:"vendor_to_admin",subject:"api\xA0message",companies:{0:ee},message:" "}},te={time_from:"",time_to:""},Ge=()=>{var b,y;const[j,d]=r.exports.useState(!1),[u,M]=r.exports.useState(te),[g,v]=r.exports.useState(!1),{data:i,isLoading:F,isFetchingNextPage:T,fetchNextPage:w,error:s,isError:N}=Y(u),{isLoading:P,mutateAsync:k}=K(),B=R(),L=z(),[h]=a.useForm(),f=async t=>{l.thread.message=t.message,l.thread.subject=t.subject,k(l,{onSuccess:o=>{I.success({message:"Message sent successfully!"}),B.invalidateQueries(["admin_messages"]),_(),h.resetFields()},onError:o=>{I.error({message:"Failed to send message",description:o.message})}})},q=t=>{console.log("Failed:",t)};let E=r.exports.useMemo(()=>{var o;let t=[];return(o=i==null?void 0:i.pages)==null||o.map(m=>{var C,x;(x=Object.values(((C=m==null?void 0:m.data)==null?void 0:C.threads)||{}))==null||x.map(Q=>{t.push(Q)})}),t||[]},[i]);const H=t=>{const o=t.target.scrollTop+t.target.offsetHeight+100>t.target.scrollHeight;v(o)},O=()=>{d(!0)},_=()=>{d(!1)};return U(()=>{!g||w()},300,[g]),N?e(D,{status:(b=s==null?void 0:s.response)==null?void 0:b.status,title:(y=s==null?void 0:s.response)==null?void 0:y.status,subTitle:s==null?void 0:s.message,extra:e(A,{type:"primary",onClick:()=>L("/"),children:"Back Home"})}):n("div",{children:[n("div",{className:p.top_nav,children:[n(c,{children:[e(c.Item,{children:"Message Center"}),e(c.Item,{children:"Admin Communications"})]}),e("div",{onClick:O,className:p.new_add_btn,children:e(G,{size:25})}),e(W,{width:800,title:"Contact administrator",open:j,onOk:f,onCancel:_,okText:"Create",cancelText:"Cancel",okButtonProps:{style:{display:"none"}},cancelButtonProps:{style:{display:"none"}},children:n(a,{layout:"vertical",form:h,className:p.form,onFinish:f,onFinishFailed:q,autoComplete:"off",children:[e(a.Item,{label:"Subject",name:"subject",rules:[{required:!0,message:"Please enter subject"}],children:e(S,{type:"text"})}),e(a.Item,{label:"Your message to administrator",name:"message",rules:[{required:!0,message:"Please enter your message"}],children:e($,{rows:8,placeholder:"Type a message..."})}),e(a.Item,{label:"",children:e(A,{loading:P,type:"primary",htmlType:"submit",style:{float:"right"},children:"Send"})})]})})]}),e(J,{setParams:M,params:u}),e(V,{handleScroll:H,data:E,loading:F||T})]})};export{Ge as default};
