import{i as be,k as _e,l as xe,q as Ie,b as t,r as b,y as we,z as Ne,f as g,d as V,M as Ee,_ as de,C as Te,v as se,x as Me,j,bs as Oe,N as Le,O as ze,P as je,Q as De,aU as me,ao as ke,a as He,X as Be}from"./index.2fea9b70.js";import{T as fe}from"./Table.7ec01c5e.js";import{a as Fe}from"./index.esm.2225375c.js";import{I as H}from"./index.d50c1940.js";import{n as Pe,o as Ae,p as Ve,q as Re}from"./ProductApi.2f3c200d.js";import{S as le}from"./index.5de7cfda.js";import{I as qe}from"./index.b065cf3d.js";import{D as ue}from"./dropdown.0343149c.js";import{B as pe}from"./button.8d7ffa1a.js";import{M as ge}from"./index.452d91e1.js";import{I as $e}from"./render.a8adff37.js";import{g as We}from"./index.171e0a82.js";import{T as q}from"./index.e276c020.js";import"./motion.cd9ea6a7.js";import"./isEqual.cc883666.js";import"./useMergedState.acd959e8.js";import"./pickAttrs.18ca283f.js";import"./styleChecker.9361c740.js";import"./index.f5b4f9b0.js";import"./css.d6e3059f.js";import"./Pagination.75c29296.js";import"./LeftOutlined.67edc2db.js";import"./RightOutlined.19164f95.js";import"./useForceUpdate.997a6267.js";import"./responsiveObserve.6b5848d4.js";import"./index.90d07be9.js";import"./Compact.c7a1bef5.js";import"./index.60d0402b.js";import"./index.11d6766c.js";import"./LoadingOutlined.3aeec88a.js";import"./collapse.3b35c5c9.js";import"./SearchOutlined.3b0489e1.js";import"./DownOutlined.653e5bd2.js";import"./index.de03715e.js";import"./TextArea.38af062b.js";import"./statusUtils.ab87837f.js";import"./EyeOutlined.b9911e82.js";import"./apiConfig.eaaa62ce.js";import"./axios.0a901153.js";import"./config.42e56451.js";import"./useNotification.7663c963.js";import"./useMutation.esm.8bfe2ba0.js";import"./utils.esm.061cfd12.js";import"./useInfiniteQuery.esm.f9f05d77.js";import"./useQuery.esm.8aa31306.js";import"./Overflow.1e0ec03a.js";import"./CheckOutlined.45292deb.js";import"./PurePanel.7897ccec.js";import"./index.d768f20b.js";import"./Dropdown.1d3385b2.js";import"./useFlexGapSupport.a59bf389.js";var Ge=function(s){be(r,s);var e=_e(r);function r(){var a;return xe(this,r),a=e.apply(this,arguments),a.state={error:void 0,info:{componentStack:""}},a}return Ie(r,[{key:"componentDidCatch",value:function(i,u){this.setState({error:i,info:u})}},{key:"render",value:function(){var i=this.props,u=i.message,v=i.description,h=i.children,I=this.state,E=I.error,T=I.info,w=T&&T.componentStack?T.componentStack:null,N=typeof u>"u"?(E||"").toString():u,y=typeof v>"u"?w:v;return E?t(he,{type:"error",message:N,description:t("pre",{children:y})}):h}}]),r}(b.exports.Component);const Qe=Ge;var X=function(e,r,a,i,u){return g({backgroundColor:e,border:i.lineWidth+"px "+i.lineType+" "+r},u+"-icon",{color:a})},Xe=function(e){var r,a,i,u=e.componentCls,v=e.motionDurationSlow,h=e.marginXS,I=e.marginSM,E=e.fontSize,T=e.fontSizeLG,w=e.lineHeight,N=e.borderRadiusLG,y=e.motionEaseInOutCirc,l=e.alertIconSizeLG,c=e.colorText,_=e.paddingContentVerticalSM,x=e.alertPaddingHorizontal,f=e.paddingMD,p=e.paddingContentHorizontalLG;return i={},g(i,u,V(V({},Ee(e)),(r={position:"relative",display:"flex",alignItems:"center",padding:_+"px "+x+"px",wordWrap:"break-word",borderRadius:N,"&&-rtl":{direction:"rtl"}},g(r,u+"-content",{flex:1,minWidth:0}),g(r,u+"-icon",{marginInlineEnd:h,lineHeight:0}),g(r,"&-description",{display:"none",fontSize:E,lineHeight:w}),g(r,"&-message",{color:c}),g(r,"&&-motion-leave",{overflow:"hidden",opacity:1,transition:"max-height "+v+" "+y+", opacity "+v+" "+y+`,
        padding-top `+v+" "+y+", padding-bottom "+v+" "+y+`,
        margin-bottom `+v+" "+y}),g(r,"&&-motion-leave-active",{maxHeight:0,marginBottom:"0 !important",paddingTop:0,paddingBottom:0,opacity:0}),r))),g(i,u+"-with-description",(a={alignItems:"flex-start",paddingInline:p,paddingBlock:f},g(a,u+"-icon",{marginInlineEnd:I,fontSize:l,lineHeight:0}),g(a,u+"-message",{display:"block",marginBottom:h,color:c,fontSize:T}),g(a,u+"-description",{display:"block"}),a)),g(i,u+"-banner",{marginBottom:0,border:"0 !important",borderRadius:0}),i},Ue=function(e){var r=e.componentCls,a=e.colorSuccess,i=e.colorSuccessBorder,u=e.colorSuccessBg,v=e.colorWarning,h=e.colorWarningBorder,I=e.colorWarningBg,E=e.colorError,T=e.colorErrorBorder,w=e.colorErrorBg,N=e.colorInfo,y=e.colorInfoBorder,l=e.colorInfoBg;return g({},r,{"&-success":X(u,i,a,e,r),"&-info":X(l,y,N,e,r),"&-warning":X(I,h,v,e,r),"&-error":V(V({},X(w,T,E,e,r)),g({},r+"-description > pre",{margin:0,padding:0}))})},Ye=function(e){var r,a=e.componentCls,i=e.iconCls,u=e.motionDurationMid,v=e.marginXS,h=e.fontSizeIcon,I=e.colorIcon,E=e.colorIconHover;return g({},a,(r={},g(r,"&-action",{marginInlineStart:v}),g(r,a+"-close-icon",g({marginInlineStart:v,padding:0,overflow:"hidden",fontSize:h,lineHeight:h+"px",backgroundColor:"transparent",border:"none",outline:"none",cursor:"pointer"},i+"-close",{color:I,transition:"color "+u,"&:hover":{color:E}})),g(r,"&-close-text",{color:I,transition:"color "+u,"&:hover":{color:E}}),r))},Ke=function(e){return[Xe(e),Ue(e),Ye(e)]};const Je=we("Alert",function(s){var e=s.fontSizeHeading3,r=Ne(s,{alertIconSizeLG:e,alertPaddingHorizontal:12});return[Ke(r)]});var Ze=globalThis&&globalThis.__rest||function(s,e){var r={};for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&e.indexOf(a)<0&&(r[a]=s[a]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,a=Object.getOwnPropertySymbols(s);i<a.length;i++)e.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(s,a[i])&&(r[a[i]]=s[a[i]]);return r},er={success:ze,info:$e,error:je,warning:De},rr=function(e){var r=e.icon,a=e.prefixCls,i=e.type,u=er[i]||null;return r?Oe(r,t("span",{className:a+"-icon",children:r}),function(){return{className:se(a+"-icon",g({},r.props.className,r.props.className))}}):b.exports.createElement(u,{className:a+"-icon"})},tr=function(e){var r=e.isClosable,a=e.closeText,i=e.prefixCls,u=e.closeIcon,v=e.handleClose;return r?t("button",{type:"button",onClick:v,className:i+"-close-icon",tabIndex:0,children:a?t("span",{className:i+"-close-text",children:a}):u}):null},ve=function(e){var r,a=e.description,i=e.prefixCls,u=e.message,v=e.banner,h=e.className,I=h===void 0?"":h,E=e.style,T=e.onMouseEnter,w=e.onMouseLeave,N=e.onClick,y=e.afterClose,l=e.showIcon,c=e.closable,_=e.closeText,x=e.closeIcon,f=x===void 0?t(Le,{}):x,p=e.action,M=Ze(e,["description","prefixCls","message","banner","className","style","onMouseEnter","onMouseLeave","onClick","afterClose","showIcon","closable","closeText","closeIcon","action"]),O=b.exports.useState(!1),k=de(O,2),B=k[0],U=k[1],Y=b.exports.useRef(),W=b.exports.useContext(Te),K=W.getPrefixCls,J=W.direction,C=K("alert",i),G=Je(C),A=de(G,2),Z=A[0],ee=A[1],re=function(L){var P;U(!0),(P=M.onClose)===null||P===void 0||P.call(M,L)},te=function(){var L=M.type;return L!==void 0?L:v?"warning":"info"},oe=_?!0:c,R=te(),Q=v&&l===void 0?!0:l,ne=se(C,C+"-"+R,(r={},g(r,C+"-with-description",!!a),g(r,C+"-no-icon",!Q),g(r,C+"-banner",!!v),g(r,C+"-rtl",J==="rtl"),r),I,ee),ae=We(M);return Z(t(Me,{visible:!B,motionName:C+"-motion",motionAppear:!1,motionEnter:!1,onLeaveStart:function(L){return{maxHeight:L.offsetHeight}},onLeaveEnd:y,children:function(F){var L=F.className,P=F.style;return j("div",{ref:Y,"data-show":!B,className:se(ne,L),style:V(V({},E),P),onMouseEnter:T,onMouseLeave:w,onClick:N,role:"alert",...ae,children:[Q?t(rr,{description:a,icon:M.icon,prefixCls:C,type:R}):null,j("div",{className:C+"-content",children:[u?t("div",{className:C+"-message",children:u}):null,a?t("div",{className:C+"-description",children:a}):null]}),p?t("div",{className:C+"-action",children:p}):null,t(tr,{isClosable:!!oe,closeText:_,prefixCls:C,closeIcon:f,handleClose:re})]})}}))};ve.ErrorBoundary=Qe;const he=ve,or="_feature_main_a23kj_1",nr="_action_btn_a23kj_7",ar="_right_buttons_a23kj_15",ir="_variation_modal_a23kj_21",lr="_modal_body_a23kj_33",z={feature_main:or,action_btn:nr,right_buttons:ar,variation_modal:ir,modal_body:lr},sr=({data:s,columns:e,loading:r})=>{const a=me();return t("div",{children:t(fe,{id:"product",rowKey:"product_id",columns:e,dataSource:s,pagination:!1,loading:r,scroll:{y:a.height>670?500:300,x:1e3}})})};const cr=({data:s,loading:e,product_data:r,setVariationLength:a,finalData:i,setFinalData:u})=>{const v=me(),[h,I]=b.exports.useState([]);b.exports.useEffect(()=>{var l;(l=s[0])!=null&&l.value?I(T(s)):I(w(s)[0]!==void 0?w(s):"")},[s]),b.exports.useEffect(()=>{h.length&&(E(h),a(h.length))},[h]);const E=(l=[])=>{let c={...i},_={},x={},f={};Object.keys(l[0].ids).map((p,M)=>{_[M]=p;let O={};l.map((k,B)=>{Object.values(O).includes(k.ids[p])||(O[B]=k.ids[p])}),x[p]=O}),l.map((p,M)=>{let O="";Object.values(p.ids).map((k,B)=>{O=O+"_"+k}),M===0?f[O.slice(1)]={active:1,product_name:p.name,product_code:p.code,product_price:p.price,product_amount:p.quantity}:f[O.slice(1)]={active:1,product_name:p.name,product_code:p.code,product_price:p.price,product_amount:p.quantity}}),c.feature_ids={..._},c.features_variants_ids={...x},c.combinations_data={...f},u({...c})},T=l=>l==null?void 0:l.map((c,_)=>({name:r==null?void 0:r.product,feature:c==null?void 0:c.label,code:r.product_code?r.product_code+"_"+N(1e3,9999):"product_"+N(1e3,9999),price:r==null?void 0:r.price,quantity:r==null?void 0:r.amount,key:_,feature_id:c.feature_id,variant_id:c.value,ids:{[c==null?void 0:c.feature_id]:c==null?void 0:c.value}})),w=l=>l==null?void 0:l.map((c,_)=>{if(c.length){let x="",f={};return c.map(p=>{f[p==null?void 0:p.feature_id]=p==null?void 0:p.value,x=x+", "+(p==null?void 0:p.label)}),{name:r==null?void 0:r.product,feature:x.substring(1),code:r.product_code?r.product_code+"_"+N(1e3,9999):"product_"+N(1e3,9999),price:r==null?void 0:r.price,quantity:r==null?void 0:r.amount,key:_,ids:f}}});function N(l,c){return Math.floor(Math.random()*(c-l+1)+l)}return j("div",{children:[t("p",{children:"Modify the variations to be created."}),t(fe,{id:"product",loading:e,columns:[{title:"FEATURES",dataIndex:"feature",key:"feature",render:l=>t("div",{children:t("b",{children:l})})},{title:"NAME",dataIndex:"name",key:"name",render:(l,c,_)=>t("div",{children:t(H,{value:l,onChange:x=>{let f=[...h];f[_].name=x.target.value,I(f)}})})},{title:"CODE",dataIndex:"code",key:"code",render:(l,c,_)=>t("div",{children:t(H,{value:l,onChange:x=>{let f=[...h];f[_].code=x.target.value,I(f)}})})},{title:"PRICE",key:"price",dataIndex:"price",render:(l,c,_)=>t("div",{children:t(H,{style:{width:"80px"},type:"number",value:parseFloat(l).toFixed(2),onChange:x=>{let f=[...h];f[_].price=x.target.value,I(f)}})})},{title:"QUANTITY",key:"quantity",dataIndex:"quantity",render:(l,c,_)=>t("div",{children:t(H,{style:{width:"80px"},type:"number",value:l,onChange:x=>{let f=[...h];f[_].quantity=x.target.value,I(f)}})})}],dataSource:h,pagination:!1,scroll:{y:v.height>670?450:200,x:1e3}})]})};let $="";const{confirm:dr}=ge,st=({data:s,variations:e,editID:r})=>{const[a,i]=b.exports.useState(!1),[u,v]=b.exports.useState(""),[h,I]=b.exports.useState([]),[E,T]=b.exports.useState(""),[w,N]=b.exports.useState([]),[y,l]=b.exports.useState({}),[c,_]=b.exports.useState(0),[x,f]=b.exports.useState([]),[p,M]=b.exports.useState(!0),[O,k]=b.exports.useState({product_id:r,feature_ids:{},features_variants_ids:{},check_all:"Y",combinations_data:{}}),{mutate:B,isLoading:U}=Pe(),{mutate:Y,isLoading:W}=Ae(),{mutate:K,isLoading:J}=Ve(),{data:C,isLoading:G}=Re(s==null?void 0:s.variation_group_id),A=ke(),Z=He();b.exports.useEffect(()=>{Object.values(y).length>1?f(ee([...Object.values(y)])):Object.values(y)[0]&&f(Object.values(y)[0])},[y]);function ee(n){return n.filter(o=>o.length!=0).reduce(function(o,d){return o.map(function(m){return d.map(function(S){return m.concat(S)})}).reduce(function(m,S){return m.concat(S)},[])},[[]])}b.exports.useEffect(()=>{var n;C!=null&&C.data?N((n=C==null?void 0:C.data)==null?void 0:n.products):N([])},[C]),b.exports.useEffect(()=>{var n;v((n=e==null?void 0:e.filter(o=>!(o!=null&&o.children)))==null?void 0:n.map(o=>{var d;return{value:o==null?void 0:o.id,label:o==null?void 0:o.text,variation:Object.values((d=o==null?void 0:o.object)==null?void 0:d.variants)}}))},[e]),b.exports.useEffect(()=>{$=E},[E]);const re=[{label:t("div",{onClick:()=>L("A"),children:"Active"}),value:"A",key:"0"},{label:t("div",{onClick:()=>L("D"),children:"Disabled"}),value:"D",key:"1"},{label:t("div",{onClick:()=>L("H"),children:"Hidden"}),value:"H",key:"2"}],te=n=>{switch(n){case"H":return t(q,{color:"purple",children:"Hidden"});case"A":return t(q,{color:"green",children:"Active"});case"D":return t(q,{color:"orange",children:"Disabled"});case"R":return t(q,{color:"red",children:"Requires Approval"});case"X":return t(q,{color:"magenta",children:"Disapproved"});default:return"Attention required"}},oe=[{label:t("a",{onClick:()=>F($),children:"Edit"}),key:"0"},{label:t("a",{href:"#",onClick:()=>R("Do you want to remove variation from group?","",`product_variations/${$}/detach_product_variation`,"post"),children:"Remove variation from group"}),key:"1"},{label:t("a",{href:"#",onClick:()=>R("Do you want to delete the item?","",`products/${$}`,"delete"),children:"Delete product"}),key:"2"}];function R(n,o,d,m){dr({title:n,content:o,async onOk(){Y({url:d,method:m},{onSuccess:D=>{A.invalidateQueries(["variation_group"])}})},onCancel(){}})}const Q=(n,o)=>{I(m=>[...m,o]),l({...y,[o.value]:[]});const d=u.filter(m=>m.value!==n);v(d)},ne=n=>{},ae=async n=>{B({id:n,data:O},{onSuccess:d=>{A.invalidateQueries(["variation_group"]),i(!1)}})},F=async n=>{Z("../products/"+n),location.reload()},L=async n=>{K({id:$,status:{status:n}},{onSuccess:()=>{A.invalidateQueries(["variation_group"])}})},P=(n,o)=>{l({...y,[o.feature_id]:[...y[o.feature_id],o]})},ye=(n,o)=>{l({...y,[o.feature_id]:[...y[o.feature_id].filter(d=>d.value!==o.value)]})};let Ce=Object.values(s.variation_features).map((n,o)=>({title:n.internal_name,dataIndex:n.internal_name,key:n.internal_name,width:"15%",render:(d,m,S)=>t("div",{children:t(le,{style:{width:"100%"},value:m.variation_features[n.feature_id].variant_id,onChange:(D,ce)=>{let ie=[...w];ie[S].variation_features[n.feature_id].variant_id=D,ie[S].variation_features[n.feature_id].variant=ce.label,N(ie),M(!1)},options:Object.values(e.filter(D=>D.id==n.feature_id)[0].object.variants).map((D,ce)=>({label:D.variant,value:D.variant_id}))})},o)})),Se=[{title:"Name/Image",dataIndex:"product",key:"product",render:(n,o)=>j("div",{className:z.image_and_name,children:[t(qe,{width:70,src:o.main_pair?o.main_pair.detailed.image_path:"",alt:""}),j("p",{children:[" ",t("b",{children:o.product})]})]})},{title:"Code",dataIndex:"product_code",key:"product_code",render:(n,o,d)=>t("div",{children:t(H,{value:n,onChange:m=>{let S=[...w];S[d].product_code=m.target.value,N(S),M(!1)}})})},...Ce,{title:"Price",dataIndex:"price",key:"price",render:(n,o,d)=>t("div",{children:t(H,{type:"number",value:parseFloat(n).toFixed(2),onChange:m=>{let S=[...w];S[d].price=m.target.value,N([...S]),M(!1)}})})},{title:"Quantity",dataIndex:"amount",key:"amount",render:(n,o,d)=>t(Be.Fragment,{children:t(H,{type:"number",value:n,onChange:m=>{let S=[...w];S[d].amount=m.target.value,N([...S]),M(!1)}})})},{title:"Action",dataIndex:"action",key:"action",width:"8%",render:(n,o)=>t("div",{className:z.action_btn,children:t(ue,{menu:{items:oe},trigger:["click"],children:t("a",{href:"#",children:t(Fe,{onClick:()=>T(o.product_id),size:20,className:z.icons})})})})},{title:"Status",dataIndex:"status",key:"status",width:"10%",render:(n,o)=>t("div",{children:t(ue,{menu:{items:re},trigger:["click"],children:t("div",{onClick:()=>T(o.product_id),children:te(n)})})})}];return j("div",{className:z.variations,children:[j("div",{className:z.variations_top,children:[t(H,{style:{width:"300px"},addonBefore:"Variation group",defaultValue:s==null?void 0:s.variation_group_code}),j("div",{style:{float:"right"},className:z.right_buttons,children:[t(pe,{disabled:p,type:"primary",children:"Save changes"}),t(pe,{style:{float:"right"},type:"primary",onClick:()=>i(!0),children:"Add variations"})]}),t("div",{}),t(ge,{title:"Add variation",maskClosable:!1,centered:!0,width:1e3,open:a,onOk:()=>ae(r),okText:c!==0?`Create ${c} variations`:"Create variation",onCancel:()=>i(!1),className:z.variation_modal,okButtonProps:{loading:U,disabled:c===0},children:j("div",{className:z.modal_body,children:[j("div",{children:[" ",t(le,{showSearch:!0,style:{width:200},onSelect:Q,placeholder:"Search to Select",optionFilterProp:"children",filterOption:(n,o)=>{var d;return((d=o==null?void 0:o.label)!=null?d:"").includes(n)},filterSort:(n,o)=>{var d,m;return((d=n==null?void 0:n.label)!=null?d:"").toLowerCase().localeCompare(((m=o==null?void 0:o.label)!=null?m:"").toLowerCase())},options:w.length?"":u}),w!=null&&w.length?t("div",{className:z.warning,style:{marginTop:"10px",marginRight:"10px"},children:t(he,{message:"You can add a new variation if you disband the group in the actions menu and create variations again.",type:"warning"})}):"",h.map((n,o)=>j("div",{className:z.feature_main,children:[t("span",{children:t("b",{children:n.label})}),t(le,{mode:"multiple",onDropdownVisibleChange:ne,showSearch:!0,onDeselect:ye,onSelect:P,placeholder:"Search to Select",optionFilterProp:"children",style:{width:"100%",paddingRight:"40px"},filterOption:(d,m)=>{var S;return((S=m==null?void 0:m.label)!=null?S:"").includes(d)},filterSort:(d,m)=>{var S,D;return((S=d==null?void 0:d.label)!=null?S:"").toLowerCase().localeCompare(((D=m==null?void 0:m.label)!=null?D:"").toLowerCase())},options:n.variation.map(d=>({label:d.variant,value:d.variant_id,feature_id:n.value}))})]},o))]}),t("div",{className:z.modal_variation_table,children:t(cr,{loading:G,data:x,product_data:s,finalData:O,setFinalData:k,setVariationLength:_})})]})})]}),t("div",{className:z.variations_table,children:t(sr,{loading:J||W||G,data:w,columns:Se})})]})};export{st as default};
