import{r as l,ao as V,aU as j,j as c,b as r}from"./index.2fea9b70.js";import{m as G}from"./ProductApi.2f3c200d.js";import{C as N}from"./index.576a1fa8.js";import{F as s}from"./index.45329f15.js";import{I as g}from"./index.d50c1940.js";import{S as y}from"./index.5de7cfda.js";import{B as b}from"./button.8d7ffa1a.js";import{T as U}from"./Table.7ec01c5e.js";import"./apiConfig.eaaa62ce.js";import"./axios.0a901153.js";import"./config.42e56451.js";import"./render.a8adff37.js";import"./useNotification.7663c963.js";import"./useMutation.esm.8bfe2ba0.js";import"./utils.esm.061cfd12.js";import"./useInfiniteQuery.esm.f9f05d77.js";import"./useQuery.esm.8aa31306.js";import"./Dropdown.1d3385b2.js";import"./useMergedState.acd959e8.js";import"./Overflow.1e0ec03a.js";import"./index.f5b4f9b0.js";import"./motion.cd9ea6a7.js";import"./isEqual.cc883666.js";import"./PlusOutlined.f1c18f31.js";import"./index.de03715e.js";import"./collapse.3b35c5c9.js";import"./LoadingOutlined.3aeec88a.js";import"./row.7750d1e9.js";import"./useFlexGapSupport.a59bf389.js";import"./responsiveObserve.6b5848d4.js";import"./index.90d07be9.js";import"./Compact.c7a1bef5.js";import"./TextArea.38af062b.js";import"./statusUtils.ab87837f.js";import"./EyeOutlined.b9911e82.js";import"./SearchOutlined.3b0489e1.js";import"./pickAttrs.18ca283f.js";import"./CheckOutlined.45292deb.js";import"./DownOutlined.653e5bd2.js";import"./PurePanel.7897ccec.js";import"./styleChecker.9361c740.js";import"./css.d6e3059f.js";import"./Pagination.75c29296.js";import"./LeftOutlined.67edc2db.js";import"./RightOutlined.19164f95.js";import"./useForceUpdate.997a6267.js";import"./index.60d0402b.js";import"./index.11d6766c.js";import"./dropdown.0343149c.js";import"./index.171e0a82.js";const O="_discount_container_k3ru9_3",R="_discount_container_left_k3ru9_11",z="_discount_container_right_k3ru9_29",B="_new_add_btn_k3ru9_43",u={discount_container:O,discount_container_left:R,discount_container_right:z,new_add_btn:B},E={0:"All",1:"Guest",2:"Registered user"},ze=({id:p,price_data:t})=>{const[_,f]=l.exports.useState([]),[x,w]=l.exports.useState("A"),[m,a]=l.exports.useState([]),[C,d]=l.exports.useState([]),{isLoading:v,mutate:S}=G(),k=V(),I=j();let D=t==null?void 0:t.prices;const A=e=>{let o=x=="A"?{...e,price:e.value}:{...e,percentage_discount:e.value,price:t==null?void 0:t.price},i={prices:t==null?void 0:t.prices.map(n=>n.percentage_discount=="0"?{...n}:{...n,price:t==null?void 0:t.price}).concat(o)};h(p,i)};l.exports.useEffect(()=>{const e=Object.values(t==null?void 0:t.prices).map((o,i)=>({...o,key:i,type:o.percentage_discount=="0"?"Absolute":"Percentage",user_group:E[o.usergroup_id]}));f(e),d(t==null?void 0:t.prices)},[t]);const h=(e,o)=>{S({data:o,id:e},{onSuccess:i=>{k.invalidateQueries(["single_product",e]),a([])},onError:i=>console.log("Something went wrong,",i)})},F=e=>{e.price_type&&w(e.price_type)},L=e=>{let i=[...D].filter((n,Q)=>!e.includes(Q));d({prices:i.map(n=>n.percentage_discount=="0"?{...n}:{...n,price:t==null?void 0:t.price})})},P={selectedRowKeys:m,onChange:e=>{L(e),a(e)},getCheckboxProps:e=>({disabled:e.key===0,name:e.lower_limit})},T=m.length>0,q=[{title:"Quantity",dataIndex:"lower_limit",key:"product"},{title:"Value",dataIndex:"price",key:"price",render:(e,o)=>r("div",{children:(o==null?void 0:o.percentage_discount)=="0"?parseFloat(o.price).toFixed(2):o.percentage_discount+"%"})},{title:"Discounted amount/item",dataIndex:"price",key:"price",render:e=>r("div",{children:parseFloat(e).toFixed(2)})},{title:"Type",dataIndex:"type",key:"amount"},{title:"User Group",key:"action",dataIndex:"user_group"}];return c("div",{className:u.quantity_discount,children:[r(N,{children:r(s,{name:"basic",layout:"vertical",initialValues:{price_type:"A",usergroup_id:"0"},onFinish:A,autoComplete:"off",onValuesChange:F,children:c("div",{className:u.discount_container,children:[c("div",{className:u.discount_container_left,children:[r(s.Item,{label:"Quantity",name:"lower_limit",style:{width:"80px"},rules:[{required:!0,message:""}],children:r(g,{type:"number"})}),r(s.Item,{label:"Value",name:"value",rules:[{required:!0,message:""}],children:r(g,{type:"number"})}),r(s.Item,{label:"Type",name:"price_type",style:{width:"200px"},children:r(y,{showArrow:!0,optionFilterProp:"children",filterOption:(e,o)=>{var i;return((i=o==null?void 0:o.label)!=null?i:"").toLowerCase().includes(e.toLowerCase())},options:[{value:"A",label:"Absolute(\u0930\u0941)"},{value:"P",label:"Percent(%)"}]})}),r(s.Item,{label:"User group",name:"usergroup_id",style:{width:"200px"},children:r(y,{showArrow:!0,optionFilterProp:"children",filterOption:(e,o)=>{var i;return((i=o==null?void 0:o.label)!=null?i:"").toLowerCase().includes(e.toLowerCase())},options:[{value:"0",label:"All"},{value:"1",label:"Guest"},{value:"2",label:"Registered user"}]})})]}),r("div",{className:u.discount_container_right,children:r(s.Item,{children:r(b,{type:"primary",htmlType:"submit",children:"Save"})})})]})})}),r("div",{style:{backgroundColor:"white",padding:"10px"},children:r(b,{type:"primary",disabled:!T,onClick:()=>h(p,C),children:"Delete"})}),r(U,{id:"product",loading:v,columns:q,dataSource:_,pagination:!1,rowSelection:P,scroll:{y:I.height>670?300:200,x:1e3}})]})};export{ze as default};
