import{r as l,ao as V,aU as j,j as c,b as r}from"./index.774ea3ea.js";import{m as G}from"./ProductApi.234be05e.js";import{C as N}from"./index.debb8753.js";import{F as s}from"./index.2fdd8f43.js";import{I as g}from"./index.39e4b2c8.js";import{S as y}from"./index.f4539c3d.js";import{B as b}from"./button.1c6eda25.js";import{T as U}from"./Table.41afa7f4.js";import"./apiConfig.2a32373e.js";import"./axios.0a901153.js";import"./config.54eb1656.js";import"./render.66f9535e.js";import"./useNotification.934e0e3b.js";import"./useMutation.esm.c151e619.js";import"./utils.esm.82fab7d4.js";import"./useInfiniteQuery.esm.23b2a444.js";import"./useQuery.esm.ae6f238b.js";import"./Dropdown.9bafc5f9.js";import"./useMergedState.18b5b371.js";import"./Overflow.bc908490.js";import"./index.40d7e5d1.js";import"./motion.300408ad.js";import"./isEqual.4659e5de.js";import"./PlusOutlined.4da0bfe2.js";import"./index.26751f43.js";import"./collapse.bedc836d.js";import"./LoadingOutlined.732e1375.js";import"./row.114180a0.js";import"./useFlexGapSupport.f6cd5e9f.js";import"./responsiveObserve.84e4b503.js";import"./index.0d78aa55.js";import"./Compact.c162d62d.js";import"./TextArea.119a5545.js";import"./statusUtils.d5af00d6.js";import"./EyeOutlined.700862bb.js";import"./SearchOutlined.16cec939.js";import"./pickAttrs.087993c3.js";import"./CheckOutlined.70cf6153.js";import"./DownOutlined.719ce519.js";import"./PurePanel.f27248d0.js";import"./styleChecker.bcd3295e.js";import"./css.d6e3059f.js";import"./Pagination.43e6bda7.js";import"./LeftOutlined.de95bfb5.js";import"./RightOutlined.e389cfa8.js";import"./useForceUpdate.0ca03680.js";import"./index.23d5fe28.js";import"./index.15a5cbb2.js";import"./dropdown.adcd444c.js";import"./index.4645b33d.js";const O="_discount_container_k3ru9_3",R="_discount_container_left_k3ru9_11",z="_discount_container_right_k3ru9_29",B="_new_add_btn_k3ru9_43",u={discount_container:O,discount_container_left:R,discount_container_right:z,new_add_btn:B},E={0:"All",1:"Guest",2:"Registered user"},ze=({id:p,price_data:t})=>{const[_,f]=l.exports.useState([]),[x,w]=l.exports.useState("A"),[m,a]=l.exports.useState([]),[C,d]=l.exports.useState([]),{isLoading:v,mutate:S}=G(),k=V(),I=j();let D=t==null?void 0:t.prices;const A=e=>{let o=x=="A"?{...e,price:e.value}:{...e,percentage_discount:e.value,price:t==null?void 0:t.price},i={prices:t==null?void 0:t.prices.map(n=>n.percentage_discount=="0"?{...n}:{...n,price:t==null?void 0:t.price}).concat(o)};h(p,i)};l.exports.useEffect(()=>{const e=Object.values(t==null?void 0:t.prices).map((o,i)=>({...o,key:i,type:o.percentage_discount=="0"?"Absolute":"Percentage",user_group:E[o.usergroup_id]}));f(e),d(t==null?void 0:t.prices)},[t]);const h=(e,o)=>{S({data:o,id:e},{onSuccess:i=>{k.invalidateQueries(["single_product",e]),a([])},onError:i=>console.log("Something went wrong,",i)})},F=e=>{e.price_type&&w(e.price_type)},L=e=>{let i=[...D].filter((n,Q)=>!e.includes(Q));d({prices:i.map(n=>n.percentage_discount=="0"?{...n}:{...n,price:t==null?void 0:t.price})})},P={selectedRowKeys:m,onChange:e=>{L(e),a(e)},getCheckboxProps:e=>({disabled:e.key===0,name:e.lower_limit})},T=m.length>0,q=[{title:"Quantity",dataIndex:"lower_limit",key:"product"},{title:"Value",dataIndex:"price",key:"price",render:(e,o)=>r("div",{children:(o==null?void 0:o.percentage_discount)=="0"?parseFloat(o.price).toFixed(2):o.percentage_discount+"%"})},{title:"Discounted amount/item",dataIndex:"price",key:"price",render:e=>r("div",{children:parseFloat(e).toFixed(2)})},{title:"Type",dataIndex:"type",key:"amount"},{title:"User Group",key:"action",dataIndex:"user_group"}];return c("div",{className:u.quantity_discount,children:[r(N,{children:r(s,{name:"basic",layout:"vertical",initialValues:{price_type:"A",usergroup_id:"0"},onFinish:A,autoComplete:"off",onValuesChange:F,children:c("div",{className:u.discount_container,children:[c("div",{className:u.discount_container_left,children:[r(s.Item,{label:"Quantity",name:"lower_limit",style:{width:"80px"},rules:[{required:!0,message:""}],children:r(g,{type:"number"})}),r(s.Item,{label:"Value",name:"value",rules:[{required:!0,message:""}],children:r(g,{type:"number"})}),r(s.Item,{label:"Type",name:"price_type",style:{width:"200px"},children:r(y,{showArrow:!0,optionFilterProp:"children",filterOption:(e,o)=>{var i;return((i=o==null?void 0:o.label)!=null?i:"").toLowerCase().includes(e.toLowerCase())},options:[{value:"A",label:"Absolute(\u0930\u0941)"},{value:"P",label:"Percent(%)"}]})}),r(s.Item,{label:"User group",name:"usergroup_id",style:{width:"200px"},children:r(y,{showArrow:!0,optionFilterProp:"children",filterOption:(e,o)=>{var i;return((i=o==null?void 0:o.label)!=null?i:"").toLowerCase().includes(e.toLowerCase())},options:[{value:"0",label:"All"},{value:"1",label:"Guest"},{value:"2",label:"Registered user"}]})})]}),r("div",{className:u.discount_container_right,children:r(s.Item,{children:r(b,{type:"primary",htmlType:"submit",children:"Save"})})})]})})}),r("div",{style:{backgroundColor:"white",padding:"10px"},children:r(b,{type:"primary",disabled:!T,onClick:()=>h(p,C),children:"Delete"})}),r(U,{id:"product",loading:v,columns:q,dataSource:_,pagination:!1,rowSelection:P,scroll:{y:I.height>670?300:200,x:1e3}})]})};export{ze as default};
