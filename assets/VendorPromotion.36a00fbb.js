import{r as n,ao as k,b as r,a$ as F,j as u,X as J,v as Q}from"./index.0eae6df2.js";import{s as c}from"./Promotion.module.b34b1af2.js";import q from"./General.76806896.js";import{g as z,h as L}from"./PromotionApi.ddf8bfc2.js";import R from"./Conditions.1235b5a3.js";import W from"./Bonuses.d3e03823.js";import{B as S}from"./Breadcrumb.3e55c3b1.js";import{B as X}from"./button.bb92e4e7.js";import{m as Y}from"./index.ee32d3ae.js";import"./quill.snow.2dff12ff.js";import"./isEqual.7557051f.js";import"./ImageUploaderForPromotion.67c6c04b.js";import"./index.9a251b5a.js";import"./index.a53e5976.js";import"./motion.25de7d91.js";import"./useMergedState.e128dcb1.js";import"./collapse.d7e28f1d.js";import"./LoadingOutlined.8c764613.js";import"./row.cc463873.js";import"./useFlexGapSupport.26f67e3e.js";import"./responsiveObserve.b22e885b.js";import"./index.7a807c9f.js";import"./pickAttrs.8c22c2db.js";import"./useForceUpdate.36181d63.js";import"./EyeOutlined.e2533ce1.js";import"./progress.04d00784.js";import"./CheckOutlined.aebd02a2.js";import"./index.faab0a1d.js";import"./render.36f71972.js";import"./index.bbe2afa4.js";import"./PlusOutlined.bcf114a1.js";import"./index.e0155dc4.js";import"./index.ae11ed19.js";import"./Compact.394e1fff.js";import"./TextArea.79f23aac.js";import"./index.00b7436e.js";import"./statusUtils.bdd687b0.js";import"./SearchOutlined.83cc36da.js";import"./useNotification.b0fd12ef.js";import"./apiConfig.422f7f8e.js";import"./axios.0a901153.js";import"./config.a608364a.js";import"./useMutation.esm.b9a3c183.js";import"./utils.esm.9d23a50b.js";import"./useInfiniteQuery.esm.39b60b71.js";import"./useQuery.esm.a226e4a2.js";import"./index.esm.24474ea7.js";import"./Table.c3ea0e52.js";import"./styleChecker.c2755425.js";import"./css.d6e3059f.js";import"./index.c17da8cc.js";import"./Overflow.0bb1c80c.js";import"./DownOutlined.0d88a6a7.js";import"./PurePanel.6b30b4ea.js";import"./Pagination.e850c34f.js";import"./LeftOutlined.3acbf618.js";import"./RightOutlined.44374471.js";import"./index.db80b566.js";import"./index.ed0030b1.js";import"./dropdown.04f8b523.js";import"./Dropdown.a44dcf86.js";import"./index.7079f3c0.js";import"./apicall.28ee9ed9.js";import"./useDebounce.2d8db3a6.js";const po=({data:t})=>{const[d,j]=n.exports.useState("General"),[C,g]=n.exports.useState([]),[D,x]=n.exports.useState([]),[f,w]=n.exports.useState(""),[h,$]=n.exports.useState({image_id:"",pair_id:"",object_type:"promotion"}),[m,b]=n.exports.useState({zone:"catalog",name:"",detailed_description:"",short_description:"",from_date:"",to_date:"",priority:0,stop_other_rules:"N",status:"A"}),[a,N]=n.exports.useState({set:"all",set_value:1}),{isLoading:G,mutate:T,isError:H}=z(),{mutateAsync:P}=L(),A=k(),E=()=>{switch(d){case"General":return r(q,{image:f,setImage:w,generalData:m,setGeneralData:b,data:t,deleteImage:h,setDeleteImage:$});case"Conditions":return r(R,{conditions:D,setConditions:x,conditionValues:a,setConditionValues:N});default:return r(W,{bonuses:C,setBonuses:g})}},B=e=>{const o=new Date(parseInt(e)*1e3);var s=String(o.getUTCMonth()+1).padStart(2,"0"),p=String(o.getUTCDate()).padStart(2,"0"),l=o.getUTCFullYear();return`${l}-${s}-${p}`},M=()=>{try{if(m.name){const e=new FormData;let o={promo_main_image_data:{0:{pair_id:"",type:"M",object_id:"0",image_alt:""}},file_promo_main_image_icon:{0:"promo_main"},type_promo_main_image_icon:{0:"local"},is_high_res_promo_main_image_icon:{0:"N"}},s=D.reduce((i,v,y)=>(i[y+1]={...v},i),{}),p=C.reduce((i,v,y)=>(i[y]={...v},i),{}),l={promotion_id:t==null?void 0:t.promotion_id,promotion_data:{...m,from_date:I(m.from_date),to_date:I(m.to_date),bonuses:{...p},conditions:{...a,conditions:{...s}}}};f&&(e.append("file",f),l={...l,...o}),e.append("promotion_data",JSON.stringify(l)),h.image_id&&P(h,{onSuccess:i=>console.log("image deleted successfully")}),T(e,{onSuccess:i=>{A.invalidateQueries(["single_promotion",t==null?void 0:t.promotion_id])},onError:i=>{console.log("error on updating promotion, ",i)}})}else Y.error("Name is necessary to create a promotion.")}catch(e){console.log(e.message)}};n.exports.useEffect(()=>{O(t),U(t),V(t),_(t)},[t]);const O=e=>{let o={...m};o.name=e==null?void 0:e.name,o.detailed_description=e==null?void 0:e.detailed_description,o.short_description=e==null?void 0:e.short_description,o.from_date=B(e==null?void 0:e.from_date),o.to_date=B(e==null?void 0:e.to_date),o.priority=e==null?void 0:e.priority,o.stop_other_rules=e==null?void 0:e.stop_other_rules,b(o)},U=e=>{var o;x(e!=null&&e.conditions.length?[]:Object.values((o=e==null?void 0:e.conditions)==null?void 0:o.conditions))},V=e=>{var s,p;let o={...a};o.set=(s=e==null?void 0:e.conditions)==null?void 0:s.set,o.set_value=(p=e==null?void 0:e.conditions)==null?void 0:p.set_value,N(o)},_=e=>{g(e!=null&&e.bonuses.length?Object.values(e==null?void 0:e.bonuses):[])},I=e=>{if(e){let o=e.split("-");return`${o[2]}/${o[1]}/${o[0]}`}};return G?r(F,{}):u(J.Fragment,{children:[u("div",{className:c.breadcrumb,children:[u(S,{children:[r(S.Item,{children:"Marketing"}),r(S.Item,{children:r("a",{href:"",children:"Edit Catalog Promotion"})})]}),r(X,{onClick:M,type:"primary",children:"Save changes"})]}),u("div",{className:c.container,children:[r("div",{className:c.tabWrapper,children:["General","Conditions","Bonuses"].map((e,o)=>r("div",{className:Q(c.tab,e===d?c.bgColor:null),onClick:()=>j(e),children:e},o))}),r("div",{className:c.tabcontain,children:E()})]})]})};export{po as default};
