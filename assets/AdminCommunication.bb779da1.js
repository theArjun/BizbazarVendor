import{r,ao as R,a as z,b as e,b0 as D,j as n,bq as G}from"./index.4f23c09f.js";import{r as J,s as V}from"./index.1a6fc416.js";import{d as Y,u as K}from"./MessageCenterApi.78cd82a8.js";import{u as U}from"./useDebounce.06723c1e.js";import{F as a}from"./index.87e32118.js";import{B as A}from"./button.0e0bb488.js";import{B as c}from"./Breadcrumb.1fc5972d.js";import{M as W}from"./index.2716beec.js";import{I as S}from"./index.334a4467.js";import{n as I}from"./config.93562c2e.js";import"./apiConfig.6fee151b.js";import"./axios.0a901153.js";import"./useInfiniteQuery.esm.7b143079.js";import"./useQuery.esm.48f464b8.js";import"./utils.esm.958af8f4.js";import"./useMutation.esm.62dcf3b9.js";import"./index.7a8128c4.js";import"./motion.9212238f.js";import"./isEqual.5405dd52.js";import"./useMergedState.a9c803d6.js";import"./collapse.7fea9198.js";import"./LoadingOutlined.ad18cc7b.js";import"./row.dbcb11e5.js";import"./useFlexGapSupport.3166aa6c.js";import"./responsiveObserve.16c01648.js";import"./Compact.8d51645f.js";import"./dropdown.c5450427.js";import"./RightOutlined.dab7e2a3.js";import"./Dropdown.af716b86.js";import"./Overflow.1804b708.js";import"./index.04eab99a.js";import"./PurePanel.01378a58.js";import"./DownOutlined.72f23fd5.js";import"./render.a21f8e67.js";import"./index.ba3281eb.js";import"./pickAttrs.08767335.js";import"./index.2687a7e4.js";import"./TextArea.5556322f.js";import"./statusUtils.c3240a4a.js";import"./EyeOutlined.ac35e31d.js";import"./SearchOutlined.19f92cba.js";import"./useNotification.ddc3cd5c.js";const X="_top_nav_6pkgw_1",Z="_new_add_btn_6pkgw_9",p={top_nav:X,new_add_btn:Z},{TextArea:$}=S,{id:ee}=JSON.parse(localStorage.getItem("userinfo")),l={thread:{object_type:"",object_id:0,communication_type:"vendor_to_admin",subject:"api\xA0message",companies:{0:ee},message:" "}},te={time_from:"",time_to:""},Ge=()=>{var b,y;const[j,d]=r.exports.useState(!1),[u,M]=r.exports.useState(te),[g,v]=r.exports.useState(!1),{data:i,isLoading:F,isFetchingNextPage:T,fetchNextPage:w,error:s,isError:N}=Y(u),{isLoading:P,mutateAsync:k}=K(),B=R(),L=z(),[h]=a.useForm(),f=async t=>{l.thread.message=t.message,l.thread.subject=t.subject,k(l,{onSuccess:o=>{I.success({message:"Message sent successfully!"}),B.invalidateQueries(["admin_messages"]),_(),h.resetFields()},onError:o=>{I.error({message:"Failed to send message",description:o.message})}})},q=t=>{console.log("Failed:",t)};let E=r.exports.useMemo(()=>{var o;let t=[];return(o=i==null?void 0:i.pages)==null||o.map(m=>{var C,x;(x=Object.values(((C=m==null?void 0:m.data)==null?void 0:C.threads)||{}))==null||x.map(Q=>{t.push(Q)})}),t||[]},[i]);const H=t=>{const o=t.target.scrollTop+t.target.offsetHeight+100>t.target.scrollHeight;v(o)},O=()=>{d(!0)},_=()=>{d(!1)};return U(()=>{!g||w()},300,[g]),N?e(D,{status:(b=s==null?void 0:s.response)==null?void 0:b.status,title:(y=s==null?void 0:s.response)==null?void 0:y.status,subTitle:s==null?void 0:s.message,extra:e(A,{type:"primary",onClick:()=>L("/"),children:"Back Home"})}):n("div",{children:[n("div",{className:p.top_nav,children:[n(c,{children:[e(c.Item,{children:"Message Center"}),e(c.Item,{children:"Admin Communications"})]}),e("div",{onClick:O,className:p.new_add_btn,children:e(G,{size:25})}),e(W,{width:800,title:"Contact administrator",open:j,onOk:f,onCancel:_,okText:"Create",cancelText:"Cancel",okButtonProps:{style:{display:"none"}},cancelButtonProps:{style:{display:"none"}},children:n(a,{layout:"vertical",form:h,className:p.form,onFinish:f,onFinishFailed:q,autoComplete:"off",children:[e(a.Item,{label:"Subject",name:"subject",rules:[{required:!0,message:"Please enter subject"}],children:e(S,{type:"text"})}),e(a.Item,{label:"Your message to administrator",name:"message",rules:[{required:!0,message:"Please enter your message"}],children:e($,{rows:8,placeholder:"Type a message..."})}),e(a.Item,{label:"",children:e(A,{loading:P,type:"primary",htmlType:"submit",style:{float:"right"},children:"Send"})})]})})]}),e(J,{setParams:M,params:u}),e(V,{handleScroll:H,data:E,loading:F||T})]})};export{Ge as default};
