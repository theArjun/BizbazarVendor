import{r as l,b as t,X as ge,j as u,ao as he,a$ as fe}from"./index.559c1fcf.js";import{b as X,c as Z}from"./index.esm.267eb871.js";import{l as ye}from"./quill.snow.f0676353.js";import{u as be}from"./ImageUploaderApi.808ee727.js";import{U as ve}from"./index.3e88b7ea.js";import{M as xe}from"./index.e5e0e49c.js";import{P as we}from"./PlusOutlined.c65b7533.js";import{k as Se}from"./ProductApi.fe19781a.js";import{A as Ce}from"./apiConfig.819e96ae.js";import{u as Fe}from"./useQuery.esm.484a4dde.js";import{F as n}from"./index.d3e6f2d0.js";import{B as Ne}from"./button.c49f6243.js";import{C as H}from"./index.4fb68f20.js";import{I as S}from"./index.99653d62.js";import{S as O}from"./index.57a1466e.js";import{m as je}from"./index.9a718a0a.js";import{C as Pe}from"./index.7376aa48.js";import"./isEqual.5b0c1f76.js";import"./useMutation.esm.3622c9ad.js";import"./utils.esm.f9fc2da8.js";import"./config.d6ac9ea8.js";import"./render.6e9f9fbc.js";import"./useNotification.530e6546.js";import"./pickAttrs.09e8e693.js";import"./useMergedState.e59004d6.js";import"./LoadingOutlined.65af6f9d.js";import"./useForceUpdate.3743a744.js";import"./EyeOutlined.acaf92f0.js";import"./progress.846f0c77.js";import"./CheckOutlined.61030fcd.js";import"./index.02299b94.js";import"./motion.c94e2116.js";import"./collapse.4ef0eee8.js";import"./index.38297928.js";import"./useFlexGapSupport.39a8fd32.js";import"./useInfiniteQuery.esm.273cbf80.js";import"./axios.0a901153.js";import"./row.1adc50e8.js";import"./responsiveObserve.0df24820.js";import"./Compact.e0a86bbb.js";import"./Dropdown.40e49efe.js";import"./Overflow.0ae650b7.js";import"./index.800256bd.js";import"./index.e42cc673.js";import"./TextArea.8f7e52a8.js";import"./statusUtils.8e955008.js";import"./SearchOutlined.1243ca95.js";import"./DownOutlined.218b67e6.js";import"./PurePanel.4b452415.js";import"./index.23768e3e.js";const qe="_title_header_1ehl2_1",Ie="_close_container_1ehl2_11",c={title_header:qe,close_container:Ie};const Oe=b=>new Promise((o,x)=>{const s=new FileReader;s.readAsDataURL(b),s.onload=()=>o(s.result),s.onerror=j=>x(j)}),ke=({message:b,uploadedImage:o,setUploadedImage:x,imageCount:s,Form:j,setImageCount:w,imageList:f,finalImages:P,setFinalImages:k,setLoading:A})=>{const[B,T]=l.exports.useState(!1),[G,F]=l.exports.useState(!0),[W,V]=l.exports.useState(""),[M,Y]=l.exports.useState(""),[E,q]=l.exports.useState(f?[...f]:[]),{mutate:J,isLoading:I}=be();l.exports.useEffect(()=>{A(!!I)},[I]),l.exports.useEffect(()=>{k(f);let i={...o};w((f==null?void 0:f.length)+1),f==null||f.map((e,m)=>{i.removed_image_pair_ids[m]="",m===0?i.product_main_image_data[e==null?void 0:e.pair_id]={detailed_alt:"",type:"M",object_id:e.uid,pair_id:e.pair_id,position:m,is_new:"N"}:i.product_additional_image_data[e==null?void 0:e.pair_id]={detailed_alt:"",type:"A",object_id:e.uid,pair_id:e.pair_id,position:m,is_new:"N"}}),x(i)},[]);let Q=async i=>{let e=i.target.files[0].name.split(".").pop();if(e==="jpeg"||e==="png"||e==="jpg"){let m=new FormData;await m.append("file[]",i.target.files[0]),J(m,{onSuccess:y=>{var g,_;if(s<=0)w(d=>d+1),x({...o,product_main_image_data:{0:{detailed_alt:"",type:"M",object_id:i.target.files[0].uid,position:"0",is_new:"Y"}},type_product_main_image_detailed:{0:"uploaded"},file_product_main_image_detailed:{0:(g=y==null?void 0:y.data)==null?void 0:g.path}});else{let d={...o};w(R=>R+1),d.product_add_additional_image_data[s]={detailed_alt:"",type:"A",object_id:i.target.files[0].uid,position:String(s),is_new:"Y"},d.type_product_add_additional_image_detailed[s]="uploaded",d.file_product_add_additional_image_detailed[s]=(_=y==null?void 0:y.data)==null?void 0:_.path,x({...d})}}})}};const $=()=>T(!1),z=async i=>{!i.url&&!i.preview&&(i.preview=await Oe(i.originFileObj)),V(i.url||i.preview),T(!0),Y(i.name||i.url.substring(i.url.lastIndexOf("/")+1))},N=({fileList:i})=>{G&&q(i)},D=i=>{let e=i.name.split(".").pop();return e==="jpeg"||e==="png"||e==="jpg"?F(!0):(F(!1),b.error("You can only upload JPG/PNG file!")),!1},K=i=>{var y;let e={...o},m=[...P];if(m.length){e.removed_image_pair_ids[i.uid]=i.pair_id;let g=m.filter((_,d)=>_.uid!==i.uid);k(g)}if(i.uid===((y=e.product_main_image_data[0])==null?void 0:y.object_id))e.product_add_additional_image_data[1]?Object.values(e.product_add_additional_image_data).map((g,_)=>{_===0?(e.type_product_main_image_detailed[0]=o.type_product_add_additional_image_detailed[1],e.file_product_main_image_detailed[0]=o.file_product_add_additional_image_detailed[1],e.product_main_image_data[0]={...o.product_add_additional_image_data[1],type:"M"},e.type_product_add_additional_image_detailed={},e.product_add_additional_image_data={},e.file_product_add_additional_image_detailed={}):(e.type_product_add_additional_image_detailed[_]=o.type_product_add_additional_image_detailed[_+1],e.product_add_additional_image_data[_]=o.product_add_additional_image_data[_+1],e.file_product_add_additional_image_detailed[_]=o.file_product_add_additional_image_detailed[_+1])}):(e.type_product_main_image_detailed={},e.file_product_main_image_detailed={},e.product_main_image_data={},w(0));else{let g=0;Object.values(e.product_add_additional_image_data).map((_,d)=>{i.uid===_.object_id&&(g=g+d+1,Object.values(e.product_add_additional_image_data).length==1?(e.type_product_add_additional_image_detailed={},e.product_add_additional_image_data={},e.file_product_add_additional_image_detailed={}):(delete e.type_product_add_additional_image_detailed[d+1],delete e.product_add_additional_image_data[d+1],delete e.file_product_add_additional_image_detailed[d+1])),g!==0&&d+1>g&&(e.type_product_add_additional_image_detailed[d]=o.type_product_add_additional_image_detailed[d+1],e.product_add_additional_image_data[d]=o.product_add_additional_image_data[d+1],e.file_product_add_additional_image_detailed[d]=o.file_product_add_additional_image_detailed[d+1],delete e.type_product_add_additional_image_detailed[d+1],delete e.product_add_additional_image_data[d+1],delete e.file_product_add_additional_image_detailed[d+1])})}x(e)},U=u("div",{children:[t(we,{}),t("div",{style:{marginTop:8},children:"Upload"})]});return t(ge.Fragment,{children:t(j.Item,{label:"Images",name:"image",style:{width:"100%"},onChange:Q,children:u("div",{children:[t(ve,{action:"#",listType:"picture-card",fileList:E,onPreview:z,onChange:N,beforeUpload:D,onRemove:K,children:E.length>=8?null:U}),t(xe,{open:B,title:M,footer:null,onCancel:$,children:t("img",{alt:"example",style:{width:"100%"},src:W})})]})})})},Ae=()=>Fe({queryKey:["taxes"],queryFn:()=>Ce.get("taxes"),refetchOnWindowFocus:!1}),Ot=({editData:b,categories:o,form:x})=>{const[s,j]=l.exports.useState(!0),[w,f]=l.exports.useState(!0),[P,k]=l.exports.useState(!0),[A,B]=l.exports.useState(""),[T,G]=l.exports.useState(!1),[F,W]=l.exports.useState(!1),[V,M]=l.exports.useState([]),[Y,E]=l.exports.useState(0),[q,J]=l.exports.useState([]),[I,Q]=l.exports.useState({product_main_image_data:{},type_product_main_image_detailed:{},file_product_main_image_detailed:{},product_add_additional_image_data:{},type_product_add_additional_image_detailed:{},file_product_add_additional_image_detailed:{},removed_image_pair_ids:{},product_main_image_data:{},product_additional_image_data:{}}),{isLoading:$,mutate:z}=Se(),{data:N}=Ae(),D=he();l.exports.useEffect(()=>{F?K():M([])},[F]);const K=async()=>{var a,r;if(N.data){let p=(r=(a=N==null?void 0:N.data)==null?void 0:a.taxes)==null?void 0:r.filter(C=>C.tax==="VAT");M([...p[0].tax_id])}};l.exports.useEffect(()=>{var a;(a=b==null?void 0:b.tax_ids)==null||a.map(r=>{r=="6"&&W(!0)})},[]);var{product_id:U,product:i,category_ids:e,price:m,full_description:y,options_type:g,exceptions_type:_,product_code:d,amount:R,zero_price_action:te,tracking:ae,max_qty:ie,min_qty:de,list_price:re,tax:Te}=b||"";const oe=[{label:"Simultaneous",value:"P"},{label:"Sequential",value:"S"}],le=[{label:"Forbidden",value:"F"},{label:"Allowed",value:"A"}],ne=[{label:"Do not allow customers to add the product to cart",value:"R"},{label:"Allow customers to add the product to cart",value:"P"},{label:"Ask customer to enter the price",value:"A"}],_e=[{label:"Yes",value:"B"},{label:"No",value:"D"}],se=a=>o==null?void 0:o.filter(p=>a==null?void 0:a.includes(parseInt(p.category_id))).map(p=>({label:p.category,value:p.category_id})),pe=a=>{var C,h;let r=a!=null&&a.main_pair?a.main_pair:{},p=a!=null&&a.image_pairs?(C=Object.values(a==null?void 0:a.image_pairs))==null?void 0:C.map((v,L)=>{var ee;return{uid:`${L+1}`,name:`additional_mage_${L+1}.jpg`,status:"done",url:(ee=v==null?void 0:v.detailed)==null?void 0:ee.image_path,pair_id:v==null?void 0:v.pair_id}}):{};return Object.keys(r).length?[{uid:"0",name:"main_image.jpg",status:"done",url:(h=r==null?void 0:r.detailed)==null?void 0:h.image_path,pair_id:r==null?void 0:r.pair_id},...p]:[]},ce=a=>{var C;let r={...I};q.length&&q.map((h,v)=>{v===0?r.product_main_image_data[h.pair_id]={detailed_alt:"",type:"M",object_id:h.uid,pair_id:h.pair_id,position:v,is_new:"N"}:r.product_additional_image_data[h==null?void 0:h.pair_id]={detailed_alt:"",type:"A",object_id:h.uid,pair_id:h.pair_id,position:v,is_new:"N"}});const p={...a,...r,product_id:U,tax_ids:V,category_ids:(C=a.category_ids[0])!=null&&C.value?e:a.category_ids};z(p,{onSuccess:h=>{D.invalidateQueries(["single_product",String(U)])}})},me=a=>{console.log("Failed:",a)},ue=()=>o==null?void 0:o.map((r,p)=>({label:r.category,value:r.category_id}));return $?t(fe,{}):t("div",{className:c.formContainer,children:u(n,{form:x,name:"basic",onFinish:ce,onFinishFailed:me,autoComplete:"off",initialValues:{product:i,tracking:ae,available_qty:R,exceptions_type:_,max_qty:ie,min_qty:de,options_type:g,zero_price_action:te,amount:R,tax:"N",full_description:y,product_code:d,category_ids:se(e),price:parseFloat(m).toFixed(2),list_price:parseFloat(re).toFixed(2)},children:[t(n.Item,{style:{float:"right"},name:"submit_btn",children:t(Ne,{disabled:T,type:"primary",htmlType:"submit",children:"Save Changes"})}),u("div",{className:c.information,children:[t("div",{className:"information_title",onClick:()=>j(!s),children:u("h2",{className:c.title_header,children:["Information",s?t(Z,{}):t(X,{})]})}),u(H,{className:s?c.information_container:c.close_container,children:[t(n.Item,{label:"Name",name:"product",rules:[{required:!0,message:"Please enter product name!"}],children:t(S,{})}),t(n.Item,{id:"category",label:"Categories",name:"category_ids",rules:[{required:!0,message:"Select your product category!"}],children:t(O,{showSearch:!0,mode:"tags",placeholder:"Select a category",optionFilterProp:"children",filterOption:(a,r)=>{var p;return((p=r==null?void 0:r.label)!=null?p:"").toLowerCase().includes(a.toLowerCase())},options:ue()})}),t(n.Item,{label:"Price (\u0930\u0941)",name:"price",style:{maxWidth:300},rules:[{required:!0,message:"Please  enter product price!"}],children:t(S,{type:"number"})}),t(n.Item,{label:"List price (\u0930\u0941)",name:"list_price",style:{maxWidth:300},rules:[{required:!0,message:"Please  enter product list price!"}],children:t(S,{type:"number"})}),t(n.Item,{label:"Full description",name:"full_description",rules:[{required:!0,message:"Description is required!"}],children:t(ye,{theme:"snow",value:A,onChange:B})}),t(ke,{message:je,uploadedImage:I,setUploadedImage:Q,imageCount:Y,setImageCount:E,Form:n,imageList:pe(b),finalImages:q,setFinalImages:J,setLoading:G})]})]}),u("div",{className:c.options,children:[t("div",{className:"information_title",onClick:()=>f(!w),children:u("h2",{className:c.title_header,children:["Options setting",w?t(Z,{}):t(X,{})]})}),u(H,{className:w?c.options_container:c.close_container,children:[t(n.Item,{label:"Options type",name:"options_type",children:t(O,{className:c.input_reduce_width,style:{maxWidth:300},options:oe.map(a=>({label:a.label,value:a.value}))})}),t(n.Item,{label:"Exceptions type",name:"exceptions_type",children:t(O,{style:{maxWidth:300},options:le.map(a=>({label:a.label,value:a.value}))})})]})]}),u("div",{className:c.pricing,children:[u("div",{className:"pricing_title",onClick:()=>k(!P),children:[u("h2",{className:c.title_header,children:["Pricing/ inventory",P?t(Z,{}):t(X,{})]})," "]}),u(H,{className:P?c.pricing_container:c.close_container,children:[t(n.Item,{label:"CODE",name:"product_code",children:t(S,{type:"text"})}),t(n.Item,{label:"In stock",name:"amount",style:{width:200},children:t(S,{type:"number"})}),t(n.Item,{label:"Zero price action",name:"zero_price_action",children:t(O,{options:ne.map(a=>({label:a.label,value:a.value}))})}),t(n.Item,{label:"Track inventory",name:"tracking",extra:"When inventory is tracked, the number of products in stock will\r decrease after each purchase.",children:t(O,{style:{maxWidth:300},options:_e.map(a=>({label:a.label,value:a.value}))})}),t(n.Item,{label:"Minimum quantity to buy per product",name:"min_qty",style:{maxWidth:400},children:t(S,{type:"number"})}),t(n.Item,{label:"Maximum quantity to buy per product",name:"max_qty",style:{maxWidth:400},children:t(S,{type:"number"})}),t(n.Item,{label:"No of available quantities",name:"available_qty",style:{maxWidth:400},children:t(S,{type:"number"})}),t(n.Item,{label:"Taxes",valuePropName:"yes",name:"tax",children:t(Pe,{checked:F,onChange:a=>W(a.target.checked),children:"VAT"})})]})]})]})})};export{Ot as default};
