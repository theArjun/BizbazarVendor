import{r as d,a as z,aU as K,ao as Q,b as o,b0 as F,j as l,X as G}from"./index.0eae6df2.js";import{u as U,a as V,b as W}from"./PromotionApi.ddf8bfc2.js";import{u as X}from"./useDebounce.2d8db3a6.js";import{B as h}from"./button.bb92e4e7.js";import{B as b}from"./Breadcrumb.3e55c3b1.js";import{S as Y}from"./index.c17da8cc.js";import{T as Z}from"./Table.c3ea0e52.js";import{T as p}from"./index.d9a05769.js";import"./apiConfig.422f7f8e.js";import"./axios.0a901153.js";import"./config.a608364a.js";import"./render.36f71972.js";import"./useNotification.b0fd12ef.js";import"./useMutation.esm.b9a3c183.js";import"./utils.esm.9d23a50b.js";import"./useInfiniteQuery.esm.39b60b71.js";import"./useQuery.esm.a226e4a2.js";import"./Compact.394e1fff.js";import"./LoadingOutlined.8c764613.js";import"./dropdown.04f8b523.js";import"./RightOutlined.44374471.js";import"./Dropdown.a44dcf86.js";import"./useMergedState.e128dcb1.js";import"./Overflow.0bb1c80c.js";import"./index.00b7436e.js";import"./motion.25de7d91.js";import"./isEqual.7557051f.js";import"./PurePanel.6b30b4ea.js";import"./index.a53e5976.js";import"./collapse.d7e28f1d.js";import"./useFlexGapSupport.26f67e3e.js";import"./DownOutlined.0d88a6a7.js";import"./pickAttrs.8c22c2db.js";import"./statusUtils.bdd687b0.js";import"./CheckOutlined.aebd02a2.js";import"./SearchOutlined.83cc36da.js";import"./styleChecker.c2755425.js";import"./css.d6e3059f.js";import"./Pagination.e850c34f.js";import"./LeftOutlined.3acbf618.js";import"./useForceUpdate.36181d63.js";import"./responsiveObserve.b22e885b.js";import"./index.ae11ed19.js";import"./index.db80b566.js";import"./index.ed0030b1.js";import"./index.7079f3c0.js";import"./index.e0155dc4.js";import"./TextArea.79f23aac.js";import"./EyeOutlined.e2533ce1.js";const J="_container_moat3_1",O="_breadcumb_moat3_17",$="_buttonAddCatalog_moat3_35",tt="_promotion_name_moat3_45",ot="_action_buttons_moat3_51",i={container:J,breadcumb:O,buttonAddCatalog:$,promotion_name:tt,action_buttons:ot};function Ot(){var y,C;const[_,v]=d.exports.useState(!1),[n,x]=d.exports.useState([]),{isLoading:P,mutate:k}=U(),{isLoading:N,mutate:A}=V(),{isLoading:D,data:s,fetchNextPage:H,isFetchingNextPage:I,isError:B,error:a}=W(),u=z(),E=K(),S=Q(),g=t=>{const e=t.target.scrollTop+t.target.offsetHeight+100>t.target.scrollHeight;v(e)};d.exports.useEffect(()=>{var t;return(t=document.querySelector("#product > div > div.ant-table-body"))==null||t.addEventListener("scroll",g),()=>{var e;(e=document.querySelector("#product > div > div.ant-table-body"))==null||e.removeEventListener("scroll",g)}},[g]),X(()=>{!_||H()},300,[_]);let L=d.exports.useMemo(()=>{var e;let t=[];return(e=s==null?void 0:s.pages)==null||e.map(r=>{var m,c;(c=(m=r==null?void 0:r.data)==null?void 0:m.promotions)==null||c.map(q=>{t.push(q)})}),t||[]},[s]);const T=t=>{switch(t){case"H":return o(p,{color:"purple",children:"Hidden"});case"A":return o(p,{color:"green",children:"Active"});case"D":return o(p,{color:"orange",children:"Disabled"});default:return o(p,{color:"magenta",children:"Pending"})}},w=()=>{let e={promotion_ids:{...n.reduce((r,m,c)=>(r[c]=m,r),{})}};k(e,{onSuccess:r=>{S.invalidateQueries(["promotions"]),console.log(r,"promotion updated success")},onError:r=>{console.log("error on updating promotion, ",r)}})},M=t=>{A({table_name:"promotions",status:t,id_name:"promotion_id",ids:n},{onSuccess:r=>{S.invalidateQueries(["promotions"]),console.log(r,"promotion updated success")},onError:r=>{console.log("error on updating promotion, ",r)}})},R=[{title:"Name",key:"name",dataIndex:"name",render:(t,e)=>o(G.Fragment,{children:o("a",{onClick:()=>u("../Marketing/Promotions/"+(e==null?void 0:e.promotion_id)),className:i.promotion_name,children:t})})},{title:"Stop other rules",dataIndex:"stop_other_rules",key:"rules",render:t=>t=="N"?"No":"Yes"},{title:"Priority",dataIndex:"priority",key:"4"},{title:"Zone",dataIndex:"zone",key:"5"},{title:"Status",dataIndex:"status",key:"5",render:t=>o("a",{children:T(t)})}],j={selectedRowKeys:n,onChange:t=>{x(t)}},f=n.length>0;return B?o(F,{status:(y=a==null?void 0:a.response)==null?void 0:y.status,title:(C=a==null?void 0:a.response)==null?void 0:C.status,subTitle:a==null?void 0:a.message,extra:o(h,{type:"primary",onClick:()=>u("/"),children:"Back Home"})}):l("div",{className:i.container,children:[o("div",{className:i.breadcumb,children:l(b,{children:[o(b.Item,{children:"Marketing"}),o(b.Item,{children:o("a",{href:"",children:"Promotions"})})]})}),l("div",{className:i.container,children:[l("div",{className:i.action_buttons,children:[o(h,{disabled:!f,onClick:w,children:"Delete"}),o(Y,{disabled:!f,defaultValue:"Status",style:{width:170},onChange:M,options:[{label:"Change to Active",value:"A"},{label:"Change to Hidden",value:"H"},{label:"Change to Disabled",value:"D"}]})]}),o(Z,{id:"product",rowKey:"promotion_id",rowSelection:j,pagination:!1,loading:D||N||P||I,columns:R,dataSource:L,scroll:{y:E.height>670?500:300,x:700}})]}),o(h,{className:i.buttonAddCatalog,onClick:()=>u("/Marketing/Add Catalog Promotion"),children:"Add Catalog Promotion"})]})}export{Ot as default};
