import{aU as X,b as e,r as f,j as l,F as se}from"./index.4f23c09f.js";import{n as ce}from"./index.esm.476cd3ce.js";import{T as J}from"./Table.7ae9acac.js";import{d as de,e as le,f as ue}from"./PromotionApi.acc6f084.js";import{a as Z}from"./apicall.3416e5db.js";import{u as _e}from"./useDebounce.06723c1e.js";import{M as pe}from"./index.2716beec.js";import{I as j}from"./index.334a4467.js";import{C as me}from"./index.9fb36eb2.js";import{A as he}from"./apiConfig.6fee151b.js";import{u as be}from"./useQuery.esm.48f464b8.js";import{S as v}from"./index.421566c6.js";import{F as b}from"./index.87e32118.js";import{B as G}from"./button.0e0bb488.js";import"./motion.9212238f.js";import"./isEqual.5405dd52.js";import"./useMergedState.a9c803d6.js";import"./pickAttrs.08767335.js";import"./styleChecker.c75b564a.js";import"./index.04eab99a.js";import"./css.d6e3059f.js";import"./Pagination.61534547.js";import"./LeftOutlined.04d83dae.js";import"./RightOutlined.dab7e2a3.js";import"./useForceUpdate.f84be2ca.js";import"./responsiveObserve.16c01648.js";import"./index.2687a7e4.js";import"./Compact.8d51645f.js";import"./dropdown.c5450427.js";import"./Dropdown.af716b86.js";import"./Overflow.1804b708.js";import"./PurePanel.01378a58.js";import"./index.7a8128c4.js";import"./collapse.7fea9198.js";import"./useFlexGapSupport.3166aa6c.js";import"./index.c1ec313f.js";import"./index.48a55223.js";import"./LoadingOutlined.ad18cc7b.js";import"./SearchOutlined.19f92cba.js";import"./DownOutlined.72f23fd5.js";import"./useMutation.esm.62dcf3b9.js";import"./utils.esm.958af8f4.js";import"./useInfiniteQuery.esm.7b143079.js";import"./config.93562c2e.js";import"./render.a21f8e67.js";import"./useNotification.ddc3cd5c.js";import"./axios.0a901153.js";import"./index.ba3281eb.js";import"./TextArea.5556322f.js";import"./statusUtils.c3240a4a.js";import"./EyeOutlined.ac35e31d.js";import"./CheckOutlined.a5fb0c39.js";import"./row.dbcb11e5.js";const ge="_add_condition_field_3pu8p_1",ve="_condition_fields_3pu8p_19",fe="_particular_condition_3pu8p_39",d={add_condition_field:ge,condition_fields:ve,particular_condition:fe},Ce={eq:"Equal",neq:"Not equal",lte:"Equal or less",gte:"Equal or greater",lt:"Less",gt:"Greater",in:"In",nin:"Not in",cont:"Contains",ncont:"Does not contains"},Se=({conditions:_,setConditions:k,userData:y,productData:p,categoryData:T,loading:R})=>{const O=X(),P=u=>{let m=[..._.filter((N,S)=>S!=u)];k(m)},D=(u,m,N)=>{let S=String(u).split(",");switch(m){case"products":let w=p==null?void 0:p.filter(i=>S.includes(i==null?void 0:i.product_id)).reduce((i,n)=>(i=i+", "+(n==null?void 0:n.product),i),"");return w==null?void 0:w.slice(1);case"purchased_products":let A=p==null?void 0:p.filter(i=>S.includes(i==null?void 0:i.product_id)).reduce((i,n)=>(i=i+", "+(n==null?void 0:n.product),i),"");return A==null?void 0:A.slice(1);case"categories":let L=T==null?void 0:T.filter(i=>S.includes(i==null?void 0:i.category_id)).reduce((i,n)=>(i=i+", "+(n==null?void 0:n.category),i),"");return L==null?void 0:L.slice(1);case"users":let F=y==null?void 0:y.filter(i=>S.includes(i==null?void 0:i.user_id)).reduce((i,n)=>(i=i+", "+(n==null?void 0:n.firstname)+" "+(n==null?void 0:n.lastname),i),"");return F==null?void 0:F.slice(1);case"usergroup":return u==="1"?"Guest":"Registered user";case"feature":return N;default:return u}};return e("div",{children:e(J,{loading:R,id:"product",columns:[{title:"Operator",dataIndex:"operator",key:"operator",width:200,render:u=>Ce[u]},{title:"Condition",dataIndex:"condition",key:"condition",width:250},{title:"Values",dataIndex:"value",key:"values",render:(u,m)=>D(u,m==null?void 0:m.condition,m==null?void 0:m.value_name)},{title:"Action",key:"action",dataIndex:"action",fixed:"right",width:100,render:(u,m,N)=>e("div",{children:e(ce,{size:20,color:"rgb(231, 77, 35)",style:{cursor:"pointer"},onClick:()=>P(N)})})}],dataSource:_,pagination:!1,scroll:{y:O.height>670?300:200,x:1e3}})})},ye=[{label:"Product price",value:"price"},{label:"Products",value:"products"},{label:"Categories",value:"categories"},{label:"Purchased Products",value:"purchased_products"},{label:"Users",value:"users"},{label:"Product feature",value:"feature"},{label:"User group",value:"usergroup"},{label:"Customer is subscribed",value:"subscribed"},{label:"Customer comes by affiliate link",value:"affiliate_link"},{label:"Points on user account ",value:"reward_points"}],Re=[{label:"equal",value:"eq"},{label:"not equal",value:"neq"},{label:"equal or less",value:"lte"},{label:"equal or greater",value:"gte"},{label:"less",value:"lt"},{label:"greater",value:"gt"}],qe=[{label:"in",value:"in"},{label:"not in",value:"nin"}],Ee=[{label:"equal",value:"eq"},{label:"not equal",value:"neq"},{label:"equal or less",value:"lte"},{label:"equal or greater",value:"gte"},{label:"less",value:"lt"},{label:"greater",value:"gt"},{label:"in",value:"in"},{label:"not in",value:"nin"},{label:"contains",value:"cont"},{label:"does not contains",value:"ncont"}],Ie=[{label:"equal",value:"eq"},{label:"not equal",value:"neq"}],Pe=[{label:"Guest",value:"1"},{label:"Registered user",value:"2"}],Ne=[{label:"Yes",value:"subscribed"},{label:"No",value:"notsubscribed"}],Ae=[{label:"equal",value:"eq"},{label:"not equal",value:"neq"},{label:"equal or less",value:"lte"},{label:"equal or greater",value:"gte"},{label:"less",value:"lt"},{label:"greater",value:"gt"}],C={condition_items:ye,product_price:Re,categories:qe,product_features:Ee,user_group_condition:Ie,user_group:Pe,is_subscribed:Ne,points_on_user_account:Ae},Ue="_relative_ora10_1",xe="_absolute_ora10_9",ke="_tableRow_ora10_39",Te="_tableRow1_ora10_47",Oe="_checkbox_ora10_69",we="_tableContain_ora10_77",Le="_remove_ora10_91",Fe="_product_name_ora10_97",Ge="_variation_modal_ora10_105",x={relative:Ue,absolute:xe,tableRow:ke,tableRow1:Te,checkbox:Oe,tableContain:we,remove:Le,product_name:Fe,variation_modal:Ge},De=({modalOpen:_,setModalOpen:k,condition_data:y,ids:p,setIds:T})=>{const[R,O]=f.exports.useState([]),[P,D]=f.exports.useState([]),[q,u]=f.exports.useState(""),m=f.exports.useRef(),N=X(),S=s=>{m.current&&!m.current.contains(s.target)&&u("")};f.exports.useEffect(()=>(document.addEventListener("click",S),()=>{document.removeEventListener("click",S)}),[]),f.exports.useEffect(()=>{let s=R.reduce((c,E)=>(c=c+","+E.id,c),"");T(s.slice(1))},[R]),f.exports.useEffect(()=>{p||O([])},[p]);const w=s=>"products?is_search=Y&pname="+s+`&page=${1}&items_per_page=${50}`,A=async()=>{const s=await Z({url:w()});D(s.data.products)};_e(()=>{A()},1200,[q]);const L=(s,c)=>{if(s.target.checked&&O([...R,{...c,quantity:1,discountedPrice:0,value:0,discount:"Rs"}]),!s.target.checked){let E=[...R];E=E.filter((B,U)=>B.id!=c.id),O(E)}},F=s=>{switch(s){case"H":return"Hidden";case"A":return"Active";case"D":return"Disabled";case"R":return"Requires Approval";case"X":return"Disapproved";default:return"Attention required"}},i=(s,c)=>!!s.map((B,U)=>B.id).includes(c.id),n=[{title:"Name/Code",dataIndex:"name",render:(s,c)=>e(se,{children:l("div",{className:x.product_name,children:[e("h4",{children:c==null?void 0:c.name}),e("p",{children:c==null?void 0:c.code})]})})},{title:"Quantity",dataIndex:"quantity"},{title:"Status",dataIndex:"status",render:s=>e("div",{children:F(s)})}];return e(pe,{title:"Add products",centered:!0,open:_,onOk:()=>k(!1),className:x.variation_modal,onCancel:()=>k(!1),width:1e3,children:l("div",{className:x.tabcontain,children:[l("div",{children:[e("h2",{children:"Promotion products"}),l("div",{ref:m,className:x.relative,children:[e(j,{placeholder:"Search Product",type:"text",onFocus:()=>u(" "),value:q,onChange:s=>u(s.target.value)}),q.length>0&&e("div",{className:x.absolute,children:y==null?void 0:y.map((s,c)=>l("div",{className:x.tableRow,children:[e(me,{checked:i(R,s),className:x.checkbox,onChange:E=>L(E,s)}),l("div",{style:{marginLeft:"10px"},children:[e("div",{children:s.name}),e("div",{children:s.code})]})]},c))})]})]}),e("div",{}),e("div",{className:x.tableContain,children:e(J,{rowKey:"id",dataSource:R,columns:n,pagination:!1,scroll:{y:(N.height>670,200),x:800}})})]})})},Be=()=>be({queryKey:["features"],queryFn:()=>he.get("features"),onError:_=>console.log(_)}),o={PRODUCT_PRICE:"price",PRODUCTS:"products",CATAGORIES:"categories",PURCHASED_PRODUCTS:"purchased_products",USERS:"users",PRODUCT_FEATURE:"feature",USER_GROUP:"usergroup",SUBSCRIBED:"subscribed",AFFILIATE_LINK:"affiliate_link",REWARD_POINTS:"reward_points"};function Ht({conditions:_,setConditions:k,setConditionValues:y,conditionValues:p}){var M,Q,Y;const[T,R]=f.exports.useState(""),[O,P]=f.exports.useState(!1),[D,q]=f.exports.useState([]),[u,m]=f.exports.useState(""),[N,S]=f.exports.useState([]),[w,A]=f.exports.useState([]),[L,F]=f.exports.useState(""),{isLoading:i,data:n,isError:s}=de(),{data:c,isError:E,isLoading:B}=le(),{data:U,isError:He,isLoading:V}=ue(),{isLoading:ee,data:H}=Be();f.exports.useEffect(()=>{var a;if(H){let r=[...((a=H==null?void 0:H.data)==null?void 0:a.features)||[]],g=r==null?void 0:r.map((h,K)=>({label:h==null?void 0:h.description,value:h==null?void 0:h.feature_id}));S(g)}},[H]);const te=(a,r)=>{let g={...p};g.set=r.value,y(g)},ae=(a,r)=>{let g={...p};g.set_value=r.value,y(g)},ie=(a,r)=>{m(""),R(r.value)},re=async a=>{var r,g;A([]);try{let h=await Z({url:`features/${a}`});if(h!=null&&h.data){let K=(g=Object.values((r=h==null?void 0:h.data)==null?void 0:r.variants))==null?void 0:g.map((I,W)=>({label:I==null?void 0:I.variant,value:I==null?void 0:I.variant_id}));A(K)}}catch(h){console.log(h.message)}},oe=a=>{switch(a){case o.PRODUCT_PRICE:return l("div",{className:d.particular_condition,children:[e(b.Item,{name:"product_price_condition",rules:[{required:!0,message:""}],children:e(v,{style:{width:200},options:C.product_price})}),e(b.Item,{rules:[{required:!0,message:""}],name:"product_price_condition_value",children:e(j,{type:"number"})})]});case o.PRODUCTS:return l("div",{className:d.particular_condition,children:[e(b.Item,{name:"products_condition",rules:[{required:!0,message:""}],children:e(v,{style:{width:200},options:C.categories})}),e(G,{type:"primary",onClick:()=>z(o.PRODUCTS),children:"Add products"})]});case o.PURCHASED_PRODUCTS:return l("div",{className:d.particular_condition,children:[e(b.Item,{name:"purchased_products_condition",rules:[{required:!0,message:""}],children:e(v,{style:{width:200},options:C.categories})}),e(G,{type:"primary",onClick:()=>z(o.PURCHASED_PRODUCTS),children:"Add products"})]});case o.USERS:return l("div",{className:d.particular_condition,children:[e(b.Item,{name:"users_condition",rules:[{required:!0,message:""}],children:e(v,{style:{width:200},options:C.categories})}),e(G,{type:"primary",onClick:()=>z(o.USERS),children:"Add users"})]});case o.PRODUCT_FEATURE:return l("div",{className:d.particular_condition,children:[e(b.Item,{name:"product_feature",rules:[{required:!0,message:""}],children:e(v,{onSelect:re,style:{width:200},options:N})}),e(b.Item,{name:"product_feature_condition",rules:[{required:!0,message:""}],children:e(v,{style:{width:200},options:C.product_features})}),e(b.Item,{name:"product_feature_variant",rules:[{required:!0,message:""}],children:e(v,{onSelect:(r,g)=>F(g.label),style:{width:200},options:w})})]});case o.CATAGORIES:return l("div",{className:d.particular_condition,children:[e(b.Item,{name:"categories_condition",rules:[{required:!0,message:""}],children:e(v,{style:{width:200},options:C.categories})}),e(G,{type:"primary",onClick:()=>z(o.CATAGORIES),children:"Add categories"})]});case o.USER_GROUP:return l("div",{className:d.particular_condition,children:[e(b.Item,{name:"user_group_condition",rules:[{required:!0,message:""}],children:e(v,{style:{width:200},options:C.user_group_condition})}),e(b.Item,{name:"user_group",rules:[{required:!0,message:""}],children:e(v,{style:{width:200},options:C.user_group})})]});case o.SUBSCRIBED:return e("div",{className:d.particular_condition,children:e(b.Item,{name:"is_subscribed",rules:[{required:!0,message:""}],children:e(v,{style:{width:200},options:C.is_subscribed})})});case o.AFFILIATE_LINK:return l("div",{className:d.particular_condition,children:[e(b.Item,{name:"comes_by_affiliate",rules:[{required:!0,message:""}],children:e(v,{style:{width:200},options:C.categories})}),e(G,{type:"primary",children:"Add plan"})]});case o.REWARD_POINTS:return l("div",{className:d.particular_condition,children:[e(b.Item,{name:"points_on_user_account_condition",rules:[{required:!0,message:""}],children:e(v,{style:{width:200},options:C.points_on_user_account})}),e(b.Item,{name:"points_on_user_account_value",rules:[{required:!0,message:""}],children:e(j,{type:"number"})})]});default:return l("div",{className:d.particular_condition,children:[" ","No condition is selected"," "]})}},z=a=>{var h,K,I;let r=[...(h=n==null?void 0:n.data)==null?void 0:h.products],g=[...(K=c==null?void 0:c.data)==null?void 0:K.categories];switch(a){case o.PRODUCTS:q(r==null?void 0:r.map((t,$)=>({id:t==null?void 0:t.product_id,name:t==null?void 0:t.product,code:t==null?void 0:t.product_code,quantity:t==null?void 0:t.amount,status:t==null?void 0:t.status}))),P(!0);break;case o.PURCHASED_PRODUCTS:q(r==null?void 0:r.map((t,$)=>({id:t==null?void 0:t.product_id,name:t==null?void 0:t.product,code:t==null?void 0:t.product_code,quantity:t==null?void 0:t.amount,status:t==null?void 0:t.status}))),P(!0);break;case o.CATAGORIES:q(g==null?void 0:g.map((t,$)=>({id:t==null?void 0:t.category_id,name:t==null?void 0:t.category,code:t==null?void 0:t.category_id,quantity:t==null?void 0:t.product_count,status:t==null?void 0:t.status}))),P(!0);break;case o.USERS:let W=[...(I=U==null?void 0:U.data)==null?void 0:I.users];q(W==null?void 0:W.map((t,$)=>({id:t==null?void 0:t.user_id,name:(t==null?void 0:t.firstname)+" "+(t==null?void 0:t.lastname),code:t==null?void 0:t.email,status:t==null?void 0:t.status}))),P(!0);break}},ne=a=>{let r=[..._];switch(a.condition){case o.PRODUCT_PRICE:r=[..._,{condition:a.condition,operator:a.product_price_condition,value:a.product_price_condition_value}];break;case o.PRODUCTS:r=[..._,{condition:a.condition,operator:a.products_condition,value:u}];break;case o.CATAGORIES:r=[..._,{condition:a.condition,operator:a.categories_condition,value:u}];break;case o.PURCHASED_PRODUCTS:r=[..._,{condition:a.condition,operator:a.purchased_products_condition,value:u}];break;case o.USERS:r=[..._,{condition:a.condition,operator:a.users_condition,value:u}];break;case o.PRODUCT_FEATURE:r=[..._,{condition:a.condition,operator:a.product_feature_condition,value:a.product_feature_variant,condition_element:a.product_feature,value_name:L}];break;case o.USER_GROUP:r=[..._,{condition:a.condition,operator:a.user_group_condition,value:a.user_group}];break;case o.SUBSCRIBED:r=[..._,{condition:a.condition,value:a.is_subscribed}];break;case o.AFFILIATE_LINK:r=[..._,{condition:a.condition,operator:a.comes_by_affiliate,value:"data"}];break;case o.REWARD_POINTS:r=[..._,{condition:a.condition,operator:a.points_on_user_account_condition,value:a.points_on_user_account_value}];break}k(r)};return e("div",{className:d.container,children:l("div",{className:d.condition_body,children:[e("div",{className:d.condition_header,children:l("div",{className:d.condition_body_header_text,children:[e(v,{defaultValue:p==null?void 0:p.set,onChange:te,style:{width:70},bordered:!1,options:[{value:"all",label:"all"},{value:"any",label:"any"}]})," ","of these conditions are"," ",e(v,{defaultValue:p==null?void 0:p.set_value,onChange:ae,style:{width:80},bordered:!1,options:[{value:1,label:"true"},{value:0,label:"false"}]})]})}),l("div",{className:d.condition_body_content,children:[e(b,{onFinish:ne,children:l("div",{className:d.add_condition_field,children:[l("div",{className:d.condition_fields,children:[e(b.Item,{className:d.condition_field_item,name:"condition",rules:[{required:!0,message:""}],children:e(v,{onChange:ie,style:{width:200},options:C.condition_items})}),e("div",{className:d.selected_condition_content,children:oe(T)})]}),e(G,{htmlType:"submit",children:"Add condition"})]})}),e("div",{className:d.condition_table,children:e(Se,{conditions:_.map((a,r)=>({...a,key:r})),setConditions:k,loading:i||B||V||ee,productData:(M=n==null?void 0:n.data)==null?void 0:M.products,categoryData:(Q=c==null?void 0:c.data)==null?void 0:Q.categories,userData:(Y=U==null?void 0:U.data)==null?void 0:Y.users})})]}),e(De,{setModalOpen:P,modalOpen:O,condition_data:D,ids:u,setIds:m})]})})}export{Ht as default};
