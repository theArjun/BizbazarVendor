import{r as l,ao as V,aU as j,j as c,b as r}from"./index.559c1fcf.js";import{m as G}from"./ProductApi.fe19781a.js";import{C as N}from"./index.4fb68f20.js";import{F as s}from"./index.d3e6f2d0.js";import{I as g}from"./index.99653d62.js";import{S as y}from"./index.57a1466e.js";import{B as b}from"./button.c49f6243.js";import{T as U}from"./Table.382eff90.js";import"./apiConfig.819e96ae.js";import"./axios.0a901153.js";import"./config.d6ac9ea8.js";import"./render.6e9f9fbc.js";import"./useNotification.530e6546.js";import"./useMutation.esm.3622c9ad.js";import"./utils.esm.f9fc2da8.js";import"./useInfiniteQuery.esm.273cbf80.js";import"./useQuery.esm.484a4dde.js";import"./Dropdown.40e49efe.js";import"./useMergedState.e59004d6.js";import"./Overflow.0ae650b7.js";import"./index.800256bd.js";import"./motion.c94e2116.js";import"./isEqual.5b0c1f76.js";import"./PlusOutlined.c65b7533.js";import"./index.02299b94.js";import"./collapse.4ef0eee8.js";import"./LoadingOutlined.65af6f9d.js";import"./row.1adc50e8.js";import"./useFlexGapSupport.39a8fd32.js";import"./responsiveObserve.0df24820.js";import"./index.e42cc673.js";import"./Compact.e0a86bbb.js";import"./TextArea.8f7e52a8.js";import"./statusUtils.8e955008.js";import"./EyeOutlined.acaf92f0.js";import"./SearchOutlined.1243ca95.js";import"./pickAttrs.09e8e693.js";import"./CheckOutlined.61030fcd.js";import"./DownOutlined.218b67e6.js";import"./PurePanel.4b452415.js";import"./styleChecker.3de124d5.js";import"./css.d6e3059f.js";import"./Pagination.76f30899.js";import"./LeftOutlined.abb276d5.js";import"./RightOutlined.6508ce6f.js";import"./useForceUpdate.3743a744.js";import"./index.7376aa48.js";import"./index.23768e3e.js";import"./dropdown.496de808.js";import"./index.2534c696.js";const O="_discount_container_k3ru9_3",R="_discount_container_left_k3ru9_11",z="_discount_container_right_k3ru9_29",B="_new_add_btn_k3ru9_43",u={discount_container:O,discount_container_left:R,discount_container_right:z,new_add_btn:B},E={0:"All",1:"Guest",2:"Registered user"},ze=({id:p,price_data:t})=>{const[_,f]=l.exports.useState([]),[x,w]=l.exports.useState("A"),[m,a]=l.exports.useState([]),[C,d]=l.exports.useState([]),{isLoading:v,mutate:S}=G(),k=V(),I=j();let D=t==null?void 0:t.prices;const A=e=>{let o=x=="A"?{...e,price:e.value}:{...e,percentage_discount:e.value,price:t==null?void 0:t.price},i={prices:t==null?void 0:t.prices.map(n=>n.percentage_discount=="0"?{...n}:{...n,price:t==null?void 0:t.price}).concat(o)};h(p,i)};l.exports.useEffect(()=>{const e=Object.values(t==null?void 0:t.prices).map((o,i)=>({...o,key:i,type:o.percentage_discount=="0"?"Absolute":"Percentage",user_group:E[o.usergroup_id]}));f(e),d(t==null?void 0:t.prices)},[t]);const h=(e,o)=>{S({data:o,id:e},{onSuccess:i=>{k.invalidateQueries(["single_product",e]),a([])},onError:i=>console.log("Something went wrong,",i)})},F=e=>{e.price_type&&w(e.price_type)},L=e=>{let i=[...D].filter((n,Q)=>!e.includes(Q));d({prices:i.map(n=>n.percentage_discount=="0"?{...n}:{...n,price:t==null?void 0:t.price})})},P={selectedRowKeys:m,onChange:e=>{L(e),a(e)},getCheckboxProps:e=>({disabled:e.key===0,name:e.lower_limit})},T=m.length>0,q=[{title:"Quantity",dataIndex:"lower_limit",key:"product"},{title:"Value",dataIndex:"price",key:"price",render:(e,o)=>r("div",{children:(o==null?void 0:o.percentage_discount)=="0"?parseFloat(o.price).toFixed(2):o.percentage_discount+"%"})},{title:"Discounted amount/item",dataIndex:"price",key:"price",render:e=>r("div",{children:parseFloat(e).toFixed(2)})},{title:"Type",dataIndex:"type",key:"amount"},{title:"User Group",key:"action",dataIndex:"user_group"}];return c("div",{className:u.quantity_discount,children:[r(N,{children:r(s,{name:"basic",layout:"vertical",initialValues:{price_type:"A",usergroup_id:"0"},onFinish:A,autoComplete:"off",onValuesChange:F,children:c("div",{className:u.discount_container,children:[c("div",{className:u.discount_container_left,children:[r(s.Item,{label:"Quantity",name:"lower_limit",style:{width:"80px"},rules:[{required:!0,message:""}],children:r(g,{type:"number"})}),r(s.Item,{label:"Value",name:"value",rules:[{required:!0,message:""}],children:r(g,{type:"number"})}),r(s.Item,{label:"Type",name:"price_type",style:{width:"200px"},children:r(y,{showArrow:!0,optionFilterProp:"children",filterOption:(e,o)=>{var i;return((i=o==null?void 0:o.label)!=null?i:"").toLowerCase().includes(e.toLowerCase())},options:[{value:"A",label:"Absolute(\u0930\u0941)"},{value:"P",label:"Percent(%)"}]})}),r(s.Item,{label:"User group",name:"usergroup_id",style:{width:"200px"},children:r(y,{showArrow:!0,optionFilterProp:"children",filterOption:(e,o)=>{var i;return((i=o==null?void 0:o.label)!=null?i:"").toLowerCase().includes(e.toLowerCase())},options:[{value:"0",label:"All"},{value:"1",label:"Guest"},{value:"2",label:"Registered user"}]})})]}),r("div",{className:u.discount_container_right,children:r(s.Item,{children:r(b,{type:"primary",htmlType:"submit",children:"Save"})})})]})})}),r("div",{style:{backgroundColor:"white",padding:"10px"},children:r(b,{type:"primary",disabled:!T,onClick:()=>h(p,C),children:"Delete"})}),r(U,{id:"product",loading:v,columns:q,dataSource:_,pagination:!1,rowSelection:P,scroll:{y:I.height>670?300:200,x:1e3}})]})};export{ze as default};
