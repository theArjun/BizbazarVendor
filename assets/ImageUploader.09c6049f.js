import{r as p,b as o,X as B,j as v}from"./index.559c1fcf.js";import{u as G}from"./ImageUploaderApi.808ee727.js";import{U as E}from"./index.3e88b7ea.js";import{M as N}from"./index.e5e0e49c.js";import{P as X}from"./PlusOutlined.c65b7533.js";const k=s=>new Promise((t,c)=>{const l=new FileReader;l.readAsDataURL(s),l.onload=()=>t(l.result),l.onerror=m=>c(m)}),V=({message:s,uploadedImage:t,setUploadedImage:c,imageCount:l,Form:m,setImageCount:u,setLoading:g})=>{const[j,f]=p.exports.useState(!1),[b,y]=p.exports.useState(!0),[x,P]=p.exports.useState(""),[O,S]=p.exports.useState(""),[w,U]=p.exports.useState([]),{mutate:F,isLoading:h}=G();p.exports.useEffect(()=>{g(!!h)},[h]);let L=async d=>{let a=d.target.files[0].name.split(".").pop();if(a==="jpeg"||a==="png"||a==="jpg"){let n=new FormData;await n.append("file[]",d.target.files[0]),F(n,{onSuccess:i=>{var _,e;if(l<=0)u(r=>r+1),c({...t,product_main_image_data:{0:{detailed_alt:"",type:"M",object_id:d.target.files[0].uid,position:"0",is_new:"Y"}},type_product_main_image_detailed:{0:"uploaded"},file_product_main_image_detailed:{0:(_=i==null?void 0:i.data)==null?void 0:_.path}});else{let r={...t};u(A=>A+1),r.product_add_additional_image_data[l]={detailed_alt:"",type:"A",object_id:d.target.files[0].uid,position:String(l),is_new:"Y"},r.type_product_add_additional_image_detailed[l]="uploaded",r.file_product_add_additional_image_detailed[l]=(e=i==null?void 0:i.data)==null?void 0:e.path,c({...r})}}})}};const M=()=>f(!1),R=async d=>{!d.url&&!d.preview&&(d.preview=await k(d.originFileObj)),P(d.url||d.preview),f(!0),S(d.name||d.url.substring(d.url.lastIndexOf("/")+1))},T=({fileList:d})=>{b&&U(d)},D=d=>{let a=d.name.split(".").pop();return a==="jpeg"||a==="png"||a==="jpg"?y(!0):(y(!1),s.error("You can only upload JPG/PNG file!")),!1},J=d=>{var n;let a={...t};if(d.uid===((n=a.product_main_image_data[0])==null?void 0:n.object_id))a.product_add_additional_image_data[1]?Object.values(a.product_add_additional_image_data).map((i,_)=>{_===0?(a.type_product_main_image_detailed[0]=t.type_product_add_additional_image_detailed[1],a.file_product_main_image_detailed[0]=t.file_product_add_additional_image_detailed[1],a.product_main_image_data[0]={...t.product_add_additional_image_data[1],type:"M"},a.type_product_add_additional_image_detailed={},a.product_add_additional_image_data={},a.file_product_add_additional_image_detailed={}):(a.type_product_add_additional_image_detailed[_]=t.type_product_add_additional_image_detailed[_+1],a.product_add_additional_image_data[_]=t.product_add_additional_image_data[_+1],a.file_product_add_additional_image_detailed[_]=t.file_product_add_additional_image_detailed[_+1])}):(a.type_product_main_image_detailed={},a.file_product_main_image_detailed={},a.product_main_image_data={},u(0));else{let i=0;Object.values(a.product_add_additional_image_data).map((_,e)=>{d.uid===_.object_id&&(i=i+e+1,Object.values(a.product_add_additional_image_data).length==1?(a.type_product_add_additional_image_detailed={},a.product_add_additional_image_data={},a.file_product_add_additional_image_detailed={}):(delete a.type_product_add_additional_image_detailed[e+1],delete a.product_add_additional_image_data[e+1],delete a.file_product_add_additional_image_detailed[e+1])),i!==0&&e+1>i&&(a.type_product_add_additional_image_detailed[e]=t.type_product_add_additional_image_detailed[e+1],a.product_add_additional_image_data[e]=t.product_add_additional_image_data[e+1],a.file_product_add_additional_image_detailed[e]=t.file_product_add_additional_image_detailed[e+1],delete a.type_product_add_additional_image_detailed[e+1],delete a.product_add_additional_image_data[e+1],delete a.file_product_add_additional_image_detailed[e+1])})}c(a)},Y=v("div",{children:[o(X,{}),o("div",{style:{marginTop:8},children:"Upload"})]});return o(B.Fragment,{children:o(m.Item,{label:"Images",name:"image",style:{width:"100%"},onChange:L,children:v("div",{children:[o(E,{action:"#",listType:"picture-card",fileList:w,onPreview:R,onChange:T,beforeUpload:D,onRemove:J,children:w.length>=8?null:Y}),o(N,{open:j,title:O,footer:null,onCancel:M,children:o("img",{alt:"example",style:{width:"100%"},src:x})})]})})})};export{V as I};
