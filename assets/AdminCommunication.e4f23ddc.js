import{r,ao as R,a as z,b as e,b0 as D,j as n,bq as G}from"./index.559c1fcf.js";import{r as J,s as V}from"./index.cfd97402.js";import{d as Y,u as K}from"./MessageCenterApi.be615e63.js";import{u as U}from"./useDebounce.34ba1d43.js";import{F as a}from"./index.d3e6f2d0.js";import{B as A}from"./button.c49f6243.js";import{B as c}from"./Breadcrumb.a0c48c79.js";import{M as W}from"./index.e5e0e49c.js";import{I as S}from"./index.99653d62.js";import{n as I}from"./config.d6ac9ea8.js";import"./apiConfig.819e96ae.js";import"./axios.0a901153.js";import"./useInfiniteQuery.esm.273cbf80.js";import"./useQuery.esm.484a4dde.js";import"./utils.esm.f9fc2da8.js";import"./useMutation.esm.3622c9ad.js";import"./index.02299b94.js";import"./motion.c94e2116.js";import"./isEqual.5b0c1f76.js";import"./useMergedState.e59004d6.js";import"./collapse.4ef0eee8.js";import"./LoadingOutlined.65af6f9d.js";import"./row.1adc50e8.js";import"./useFlexGapSupport.39a8fd32.js";import"./responsiveObserve.0df24820.js";import"./Compact.e0a86bbb.js";import"./dropdown.496de808.js";import"./RightOutlined.6508ce6f.js";import"./Dropdown.40e49efe.js";import"./Overflow.0ae650b7.js";import"./index.800256bd.js";import"./PurePanel.4b452415.js";import"./DownOutlined.218b67e6.js";import"./render.6e9f9fbc.js";import"./index.38297928.js";import"./pickAttrs.09e8e693.js";import"./index.e42cc673.js";import"./TextArea.8f7e52a8.js";import"./statusUtils.8e955008.js";import"./EyeOutlined.acaf92f0.js";import"./SearchOutlined.1243ca95.js";import"./useNotification.530e6546.js";const X="_top_nav_6pkgw_1",Z="_new_add_btn_6pkgw_9",p={top_nav:X,new_add_btn:Z},{TextArea:$}=S,{id:ee}=JSON.parse(localStorage.getItem("userinfo")),l={thread:{object_type:"",object_id:0,communication_type:"vendor_to_admin",subject:"api\xA0message",companies:{0:ee},message:" "}},te={time_from:"",time_to:""},Ge=()=>{var b,y;const[j,d]=r.exports.useState(!1),[u,M]=r.exports.useState(te),[g,v]=r.exports.useState(!1),{data:i,isLoading:F,isFetchingNextPage:T,fetchNextPage:w,error:s,isError:N}=Y(u),{isLoading:P,mutateAsync:k}=K(),B=R(),L=z(),[h]=a.useForm(),f=async t=>{l.thread.message=t.message,l.thread.subject=t.subject,k(l,{onSuccess:o=>{I.success({message:"Message sent successfully!"}),B.invalidateQueries(["admin_messages"]),_(),h.resetFields()},onError:o=>{I.error({message:"Failed to send message",description:o.message})}})},q=t=>{console.log("Failed:",t)};let E=r.exports.useMemo(()=>{var o;let t=[];return(o=i==null?void 0:i.pages)==null||o.map(m=>{var C,x;(x=Object.values(((C=m==null?void 0:m.data)==null?void 0:C.threads)||{}))==null||x.map(Q=>{t.push(Q)})}),t||[]},[i]);const H=t=>{const o=t.target.scrollTop+t.target.offsetHeight+100>t.target.scrollHeight;v(o)},O=()=>{d(!0)},_=()=>{d(!1)};return U(()=>{!g||w()},300,[g]),N?e(D,{status:(b=s==null?void 0:s.response)==null?void 0:b.status,title:(y=s==null?void 0:s.response)==null?void 0:y.status,subTitle:s==null?void 0:s.message,extra:e(A,{type:"primary",onClick:()=>L("/"),children:"Back Home"})}):n("div",{children:[n("div",{className:p.top_nav,children:[n(c,{children:[e(c.Item,{children:"Message Center"}),e(c.Item,{children:"Admin Communications"})]}),e("div",{onClick:O,className:p.new_add_btn,children:e(G,{size:25})}),e(W,{width:800,title:"Contact administrator",open:j,onOk:f,onCancel:_,okText:"Create",cancelText:"Cancel",okButtonProps:{style:{display:"none"}},cancelButtonProps:{style:{display:"none"}},children:n(a,{layout:"vertical",form:h,className:p.form,onFinish:f,onFinishFailed:q,autoComplete:"off",children:[e(a.Item,{label:"Subject",name:"subject",rules:[{required:!0,message:"Please enter subject"}],children:e(S,{type:"text"})}),e(a.Item,{label:"Your message to administrator",name:"message",rules:[{required:!0,message:"Please enter your message"}],children:e($,{rows:8,placeholder:"Type a message..."})}),e(a.Item,{label:"",children:e(A,{loading:P,type:"primary",htmlType:"submit",style:{float:"right"},children:"Send"})})]})})]}),e(J,{setParams:M,params:u}),e(V,{handleScroll:H,data:E,loading:F||T})]})};export{Ge as default};
