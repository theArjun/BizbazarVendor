import{r as n,ao as k,b as r,a$ as F,j as u,X as J,v as Q}from"./index.2fea9b70.js";import{s as c}from"./Promotion.module.b34b1af2.js";import q from"./General.a8a8421c.js";import{g as z,h as L}from"./PromotionApi.0b73559b.js";import R from"./Conditions.940beb6f.js";import W from"./Bonuses.b95f04db.js";import{B as S}from"./Breadcrumb.37de7763.js";import{B as X}from"./button.8d7ffa1a.js";import{m as Y}from"./index.f682c9df.js";import"./quill.snow.98491457.js";import"./isEqual.cc883666.js";import"./ImageUploaderForPromotion.f66b132d.js";import"./index.45329f15.js";import"./index.de03715e.js";import"./motion.cd9ea6a7.js";import"./useMergedState.acd959e8.js";import"./collapse.3b35c5c9.js";import"./LoadingOutlined.3aeec88a.js";import"./row.7750d1e9.js";import"./useFlexGapSupport.a59bf389.js";import"./responsiveObserve.6b5848d4.js";import"./index.a81033fd.js";import"./pickAttrs.18ca283f.js";import"./useForceUpdate.997a6267.js";import"./EyeOutlined.b9911e82.js";import"./progress.20aceab1.js";import"./CheckOutlined.45292deb.js";import"./index.452d91e1.js";import"./render.a8adff37.js";import"./index.d768f20b.js";import"./PlusOutlined.f1c18f31.js";import"./index.d50c1940.js";import"./index.90d07be9.js";import"./Compact.c7a1bef5.js";import"./TextArea.38af062b.js";import"./index.f5b4f9b0.js";import"./statusUtils.ab87837f.js";import"./SearchOutlined.3b0489e1.js";import"./useNotification.7663c963.js";import"./apiConfig.eaaa62ce.js";import"./axios.0a901153.js";import"./config.42e56451.js";import"./useMutation.esm.8bfe2ba0.js";import"./utils.esm.061cfd12.js";import"./useInfiniteQuery.esm.f9f05d77.js";import"./useQuery.esm.8aa31306.js";import"./index.esm.2225375c.js";import"./Table.7ec01c5e.js";import"./styleChecker.9361c740.js";import"./css.d6e3059f.js";import"./index.5de7cfda.js";import"./Overflow.1e0ec03a.js";import"./DownOutlined.653e5bd2.js";import"./PurePanel.7897ccec.js";import"./Pagination.75c29296.js";import"./LeftOutlined.67edc2db.js";import"./RightOutlined.19164f95.js";import"./index.60d0402b.js";import"./index.11d6766c.js";import"./dropdown.0343149c.js";import"./Dropdown.1d3385b2.js";import"./index.171e0a82.js";import"./apicall.7005afb3.js";import"./useDebounce.857d1c38.js";const po=({data:t})=>{const[d,j]=n.exports.useState("General"),[C,g]=n.exports.useState([]),[D,x]=n.exports.useState([]),[f,w]=n.exports.useState(""),[h,$]=n.exports.useState({image_id:"",pair_id:"",object_type:"promotion"}),[m,b]=n.exports.useState({zone:"catalog",name:"",detailed_description:"",short_description:"",from_date:"",to_date:"",priority:0,stop_other_rules:"N",status:"A"}),[a,N]=n.exports.useState({set:"all",set_value:1}),{isLoading:G,mutate:T,isError:H}=z(),{mutateAsync:P}=L(),A=k(),E=()=>{switch(d){case"General":return r(q,{image:f,setImage:w,generalData:m,setGeneralData:b,data:t,deleteImage:h,setDeleteImage:$});case"Conditions":return r(R,{conditions:D,setConditions:x,conditionValues:a,setConditionValues:N});default:return r(W,{bonuses:C,setBonuses:g})}},B=e=>{const o=new Date(parseInt(e)*1e3);var s=String(o.getUTCMonth()+1).padStart(2,"0"),p=String(o.getUTCDate()).padStart(2,"0"),l=o.getUTCFullYear();return`${l}-${s}-${p}`},M=()=>{try{if(m.name){const e=new FormData;let o={promo_main_image_data:{0:{pair_id:"",type:"M",object_id:"0",image_alt:""}},file_promo_main_image_icon:{0:"promo_main"},type_promo_main_image_icon:{0:"local"},is_high_res_promo_main_image_icon:{0:"N"}},s=D.reduce((i,v,y)=>(i[y+1]={...v},i),{}),p=C.reduce((i,v,y)=>(i[y]={...v},i),{}),l={promotion_id:t==null?void 0:t.promotion_id,promotion_data:{...m,from_date:I(m.from_date),to_date:I(m.to_date),bonuses:{...p},conditions:{...a,conditions:{...s}}}};f&&(e.append("file",f),l={...l,...o}),e.append("promotion_data",JSON.stringify(l)),h.image_id&&P(h,{onSuccess:i=>console.log("image deleted successfully")}),T(e,{onSuccess:i=>{A.invalidateQueries(["single_promotion",t==null?void 0:t.promotion_id])},onError:i=>{console.log("error on updating promotion, ",i)}})}else Y.error("Name is necessary to create a promotion.")}catch(e){console.log(e.message)}};n.exports.useEffect(()=>{O(t),U(t),V(t),_(t)},[t]);const O=e=>{let o={...m};o.name=e==null?void 0:e.name,o.detailed_description=e==null?void 0:e.detailed_description,o.short_description=e==null?void 0:e.short_description,o.from_date=B(e==null?void 0:e.from_date),o.to_date=B(e==null?void 0:e.to_date),o.priority=e==null?void 0:e.priority,o.stop_other_rules=e==null?void 0:e.stop_other_rules,b(o)},U=e=>{var o;x(e!=null&&e.conditions.length?[]:Object.values((o=e==null?void 0:e.conditions)==null?void 0:o.conditions))},V=e=>{var s,p;let o={...a};o.set=(s=e==null?void 0:e.conditions)==null?void 0:s.set,o.set_value=(p=e==null?void 0:e.conditions)==null?void 0:p.set_value,N(o)},_=e=>{g(e!=null&&e.bonuses.length?Object.values(e==null?void 0:e.bonuses):[])},I=e=>{if(e){let o=e.split("-");return`${o[2]}/${o[1]}/${o[0]}`}};return G?r(F,{}):u(J.Fragment,{children:[u("div",{className:c.breadcrumb,children:[u(S,{children:[r(S.Item,{children:"Marketing"}),r(S.Item,{children:r("a",{href:"",children:"Edit Catalog Promotion"})})]}),r(X,{onClick:M,type:"primary",children:"Save changes"})]}),u("div",{className:c.container,children:[r("div",{className:c.tabWrapper,children:["General","Conditions","Bonuses"].map((e,o)=>r("div",{className:Q(c.tab,e===d?c.bgColor:null),onClick:()=>j(e),children:e},o))}),r("div",{className:c.tabcontain,children:E()})]})]})};export{po as default};
