import{r,ao as R,a as z,b as e,b0 as D,j as n,bq as G}from"./index.b239cc55.js";import{r as J,s as V}from"./index.b6374920.js";import{d as Y,u as K}from"./MessageCenterApi.b319308f.js";import{u as U}from"./useDebounce.d6117fcd.js";import{F as a}from"./index.02861738.js";import{B as A}from"./button.1e90f6e6.js";import{B as c}from"./Breadcrumb.d9f90a7e.js";import{M as W}from"./index.2b87b131.js";import{I as S}from"./index.4af21018.js";import{n as I}from"./config.79883511.js";import"./apiConfig.446075fe.js";import"./axios.0a901153.js";import"./useInfiniteQuery.esm.0432f70d.js";import"./useQuery.esm.3c1c4f21.js";import"./utils.esm.408cb86b.js";import"./useMutation.esm.61ea1354.js";import"./index.4bbb7811.js";import"./motion.0d7a897e.js";import"./isEqual.21fc3aef.js";import"./useMergedState.a28f7e87.js";import"./collapse.4a0a3d30.js";import"./LoadingOutlined.97101298.js";import"./row.7108879f.js";import"./useFlexGapSupport.1cb3c05a.js";import"./responsiveObserve.99027935.js";import"./Compact.d9f155a2.js";import"./dropdown.989042eb.js";import"./RightOutlined.47ed9d6c.js";import"./Dropdown.3bbb202b.js";import"./Overflow.8b34a4db.js";import"./index.282ea7d3.js";import"./PurePanel.ffcb695e.js";import"./DownOutlined.69351dd6.js";import"./render.1622182d.js";import"./index.9279110c.js";import"./pickAttrs.f011bab2.js";import"./index.2d340b5d.js";import"./TextArea.6c3ac8fe.js";import"./statusUtils.ab472cb9.js";import"./EyeOutlined.a43f77a8.js";import"./SearchOutlined.8331e38c.js";import"./useNotification.49a3f20c.js";const X="_top_nav_6pkgw_1",Z="_new_add_btn_6pkgw_9",p={top_nav:X,new_add_btn:Z},{TextArea:$}=S,{id:ee}=JSON.parse(localStorage.getItem("userinfo")),l={thread:{object_type:"",object_id:0,communication_type:"vendor_to_admin",subject:"api\xA0message",companies:{0:ee},message:" "}},te={time_from:"",time_to:""},Ge=()=>{var b,y;const[j,d]=r.exports.useState(!1),[u,M]=r.exports.useState(te),[g,v]=r.exports.useState(!1),{data:i,isLoading:F,isFetchingNextPage:T,fetchNextPage:w,error:s,isError:N}=Y(u),{isLoading:P,mutateAsync:k}=K(),B=R(),L=z(),[h]=a.useForm(),f=async t=>{l.thread.message=t.message,l.thread.subject=t.subject,k(l,{onSuccess:o=>{I.success({message:"Message sent successfully!"}),B.invalidateQueries(["admin_messages"]),_(),h.resetFields()},onError:o=>{I.error({message:"Failed to send message",description:o.message})}})},q=t=>{console.log("Failed:",t)};let E=r.exports.useMemo(()=>{var o;let t=[];return(o=i==null?void 0:i.pages)==null||o.map(m=>{var C,x;(x=Object.values(((C=m==null?void 0:m.data)==null?void 0:C.threads)||{}))==null||x.map(Q=>{t.push(Q)})}),t||[]},[i]);const H=t=>{const o=t.target.scrollTop+t.target.offsetHeight+100>t.target.scrollHeight;v(o)},O=()=>{d(!0)},_=()=>{d(!1)};return U(()=>{!g||w()},300,[g]),N?e(D,{status:(b=s==null?void 0:s.response)==null?void 0:b.status,title:(y=s==null?void 0:s.response)==null?void 0:y.status,subTitle:s==null?void 0:s.message,extra:e(A,{type:"primary",onClick:()=>L("/"),children:"Back Home"})}):n("div",{children:[n("div",{className:p.top_nav,children:[n(c,{children:[e(c.Item,{children:"Message Center"}),e(c.Item,{children:"Admin Communications"})]}),e("div",{onClick:O,className:p.new_add_btn,children:e(G,{size:25})}),e(W,{width:800,title:"Contact administrator",open:j,onOk:f,onCancel:_,okText:"Create",cancelText:"Cancel",okButtonProps:{style:{display:"none"}},cancelButtonProps:{style:{display:"none"}},children:n(a,{layout:"vertical",form:h,className:p.form,onFinish:f,onFinishFailed:q,autoComplete:"off",children:[e(a.Item,{label:"Subject",name:"subject",rules:[{required:!0,message:"Please enter subject"}],children:e(S,{type:"text"})}),e(a.Item,{label:"Your message to administrator",name:"message",rules:[{required:!0,message:"Please enter your message"}],children:e($,{rows:8,placeholder:"Type a message..."})}),e(a.Item,{label:"",children:e(A,{loading:P,type:"primary",htmlType:"submit",style:{float:"right"},children:"Send"})})]})})]}),e(J,{setParams:M,params:u}),e(V,{handleScroll:H,data:E,loading:F||T})]})};export{Ge as default};
