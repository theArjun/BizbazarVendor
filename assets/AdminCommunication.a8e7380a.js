import{r,ao as R,a as z,b as e,b0 as D,j as n,bq as G}from"./index.774ea3ea.js";import{r as J,s as V}from"./index.ed194364.js";import{d as Y,u as K}from"./MessageCenterApi.05764445.js";import{u as U}from"./useDebounce.1afc85d0.js";import{F as a}from"./index.2fdd8f43.js";import{B as A}from"./button.1c6eda25.js";import{B as c}from"./Breadcrumb.97460a59.js";import{M as W}from"./index.d924cf53.js";import{I as S}from"./index.39e4b2c8.js";import{n as I}from"./config.54eb1656.js";import"./apiConfig.2a32373e.js";import"./axios.0a901153.js";import"./useInfiniteQuery.esm.23b2a444.js";import"./useQuery.esm.ae6f238b.js";import"./utils.esm.82fab7d4.js";import"./useMutation.esm.c151e619.js";import"./index.26751f43.js";import"./motion.300408ad.js";import"./isEqual.4659e5de.js";import"./useMergedState.18b5b371.js";import"./collapse.bedc836d.js";import"./LoadingOutlined.732e1375.js";import"./row.114180a0.js";import"./useFlexGapSupport.f6cd5e9f.js";import"./responsiveObserve.84e4b503.js";import"./Compact.c162d62d.js";import"./dropdown.adcd444c.js";import"./RightOutlined.e389cfa8.js";import"./Dropdown.9bafc5f9.js";import"./Overflow.bc908490.js";import"./index.40d7e5d1.js";import"./PurePanel.f27248d0.js";import"./DownOutlined.719ce519.js";import"./render.66f9535e.js";import"./index.5f886e53.js";import"./pickAttrs.087993c3.js";import"./index.0d78aa55.js";import"./TextArea.119a5545.js";import"./statusUtils.d5af00d6.js";import"./EyeOutlined.700862bb.js";import"./SearchOutlined.16cec939.js";import"./useNotification.934e0e3b.js";const X="_top_nav_6pkgw_1",Z="_new_add_btn_6pkgw_9",p={top_nav:X,new_add_btn:Z},{TextArea:$}=S,{id:ee}=JSON.parse(localStorage.getItem("userinfo")),l={thread:{object_type:"",object_id:0,communication_type:"vendor_to_admin",subject:"api\xA0message",companies:{0:ee},message:" "}},te={time_from:"",time_to:""},Ge=()=>{var b,y;const[j,d]=r.exports.useState(!1),[u,M]=r.exports.useState(te),[g,v]=r.exports.useState(!1),{data:i,isLoading:F,isFetchingNextPage:T,fetchNextPage:w,error:s,isError:N}=Y(u),{isLoading:P,mutateAsync:k}=K(),B=R(),L=z(),[h]=a.useForm(),f=async t=>{l.thread.message=t.message,l.thread.subject=t.subject,k(l,{onSuccess:o=>{I.success({message:"Message sent successfully!"}),B.invalidateQueries(["admin_messages"]),_(),h.resetFields()},onError:o=>{I.error({message:"Failed to send message",description:o.message})}})},q=t=>{console.log("Failed:",t)};let E=r.exports.useMemo(()=>{var o;let t=[];return(o=i==null?void 0:i.pages)==null||o.map(m=>{var C,x;(x=Object.values(((C=m==null?void 0:m.data)==null?void 0:C.threads)||{}))==null||x.map(Q=>{t.push(Q)})}),t||[]},[i]);const H=t=>{const o=t.target.scrollTop+t.target.offsetHeight+100>t.target.scrollHeight;v(o)},O=()=>{d(!0)},_=()=>{d(!1)};return U(()=>{!g||w()},300,[g]),N?e(D,{status:(b=s==null?void 0:s.response)==null?void 0:b.status,title:(y=s==null?void 0:s.response)==null?void 0:y.status,subTitle:s==null?void 0:s.message,extra:e(A,{type:"primary",onClick:()=>L("/"),children:"Back Home"})}):n("div",{children:[n("div",{className:p.top_nav,children:[n(c,{children:[e(c.Item,{children:"Message Center"}),e(c.Item,{children:"Admin Communications"})]}),e("div",{onClick:O,className:p.new_add_btn,children:e(G,{size:25})}),e(W,{width:800,title:"Contact administrator",open:j,onOk:f,onCancel:_,okText:"Create",cancelText:"Cancel",okButtonProps:{style:{display:"none"}},cancelButtonProps:{style:{display:"none"}},children:n(a,{layout:"vertical",form:h,className:p.form,onFinish:f,onFinishFailed:q,autoComplete:"off",children:[e(a.Item,{label:"Subject",name:"subject",rules:[{required:!0,message:"Please enter subject"}],children:e(S,{type:"text"})}),e(a.Item,{label:"Your message to administrator",name:"message",rules:[{required:!0,message:"Please enter your message"}],children:e($,{rows:8,placeholder:"Type a message..."})}),e(a.Item,{label:"",children:e(A,{loading:P,type:"primary",htmlType:"submit",style:{float:"right"},children:"Send"})})]})})]}),e(J,{setParams:M,params:u}),e(V,{handleScroll:H,data:E,loading:F||T})]})};export{Ge as default};
