import{r as n,ao as k,b as r,a$ as F,j as u,X as J,v as Q}from"./index.559c1fcf.js";import{s as c}from"./Promotion.module.b34b1af2.js";import q from"./General.1450bad1.js";import{g as z,h as L}from"./PromotionApi.352b7e17.js";import R from"./Conditions.2057a235.js";import W from"./Bonuses.5c57e89f.js";import{B as S}from"./Breadcrumb.a0c48c79.js";import{B as X}from"./button.c49f6243.js";import{m as Y}from"./index.9a718a0a.js";import"./quill.snow.f0676353.js";import"./isEqual.5b0c1f76.js";import"./ImageUploaderForPromotion.f2f21912.js";import"./index.d3e6f2d0.js";import"./index.02299b94.js";import"./motion.c94e2116.js";import"./useMergedState.e59004d6.js";import"./collapse.4ef0eee8.js";import"./LoadingOutlined.65af6f9d.js";import"./row.1adc50e8.js";import"./useFlexGapSupport.39a8fd32.js";import"./responsiveObserve.0df24820.js";import"./index.3e88b7ea.js";import"./pickAttrs.09e8e693.js";import"./useForceUpdate.3743a744.js";import"./EyeOutlined.acaf92f0.js";import"./progress.846f0c77.js";import"./CheckOutlined.61030fcd.js";import"./index.e5e0e49c.js";import"./render.6e9f9fbc.js";import"./index.38297928.js";import"./PlusOutlined.c65b7533.js";import"./index.99653d62.js";import"./index.e42cc673.js";import"./Compact.e0a86bbb.js";import"./TextArea.8f7e52a8.js";import"./index.800256bd.js";import"./statusUtils.8e955008.js";import"./SearchOutlined.1243ca95.js";import"./useNotification.530e6546.js";import"./apiConfig.819e96ae.js";import"./axios.0a901153.js";import"./config.d6ac9ea8.js";import"./useMutation.esm.3622c9ad.js";import"./utils.esm.f9fc2da8.js";import"./useInfiniteQuery.esm.273cbf80.js";import"./useQuery.esm.484a4dde.js";import"./index.esm.267eb871.js";import"./Table.382eff90.js";import"./styleChecker.3de124d5.js";import"./css.d6e3059f.js";import"./index.57a1466e.js";import"./Overflow.0ae650b7.js";import"./DownOutlined.218b67e6.js";import"./PurePanel.4b452415.js";import"./Pagination.76f30899.js";import"./LeftOutlined.abb276d5.js";import"./RightOutlined.6508ce6f.js";import"./index.7376aa48.js";import"./index.23768e3e.js";import"./dropdown.496de808.js";import"./Dropdown.40e49efe.js";import"./index.2534c696.js";import"./apicall.a45120ef.js";import"./useDebounce.34ba1d43.js";const po=({data:t})=>{const[d,j]=n.exports.useState("General"),[C,g]=n.exports.useState([]),[D,x]=n.exports.useState([]),[f,w]=n.exports.useState(""),[h,$]=n.exports.useState({image_id:"",pair_id:"",object_type:"promotion"}),[m,b]=n.exports.useState({zone:"catalog",name:"",detailed_description:"",short_description:"",from_date:"",to_date:"",priority:0,stop_other_rules:"N",status:"A"}),[a,N]=n.exports.useState({set:"all",set_value:1}),{isLoading:G,mutate:T,isError:H}=z(),{mutateAsync:P}=L(),A=k(),E=()=>{switch(d){case"General":return r(q,{image:f,setImage:w,generalData:m,setGeneralData:b,data:t,deleteImage:h,setDeleteImage:$});case"Conditions":return r(R,{conditions:D,setConditions:x,conditionValues:a,setConditionValues:N});default:return r(W,{bonuses:C,setBonuses:g})}},B=e=>{const o=new Date(parseInt(e)*1e3);var s=String(o.getUTCMonth()+1).padStart(2,"0"),p=String(o.getUTCDate()).padStart(2,"0"),l=o.getUTCFullYear();return`${l}-${s}-${p}`},M=()=>{try{if(m.name){const e=new FormData;let o={promo_main_image_data:{0:{pair_id:"",type:"M",object_id:"0",image_alt:""}},file_promo_main_image_icon:{0:"promo_main"},type_promo_main_image_icon:{0:"local"},is_high_res_promo_main_image_icon:{0:"N"}},s=D.reduce((i,v,y)=>(i[y+1]={...v},i),{}),p=C.reduce((i,v,y)=>(i[y]={...v},i),{}),l={promotion_id:t==null?void 0:t.promotion_id,promotion_data:{...m,from_date:I(m.from_date),to_date:I(m.to_date),bonuses:{...p},conditions:{...a,conditions:{...s}}}};f&&(e.append("file",f),l={...l,...o}),e.append("promotion_data",JSON.stringify(l)),h.image_id&&P(h,{onSuccess:i=>console.log("image deleted successfully")}),T(e,{onSuccess:i=>{A.invalidateQueries(["single_promotion",t==null?void 0:t.promotion_id])},onError:i=>{console.log("error on updating promotion, ",i)}})}else Y.error("Name is necessary to create a promotion.")}catch(e){console.log(e.message)}};n.exports.useEffect(()=>{O(t),U(t),V(t),_(t)},[t]);const O=e=>{let o={...m};o.name=e==null?void 0:e.name,o.detailed_description=e==null?void 0:e.detailed_description,o.short_description=e==null?void 0:e.short_description,o.from_date=B(e==null?void 0:e.from_date),o.to_date=B(e==null?void 0:e.to_date),o.priority=e==null?void 0:e.priority,o.stop_other_rules=e==null?void 0:e.stop_other_rules,b(o)},U=e=>{var o;x(e!=null&&e.conditions.length?[]:Object.values((o=e==null?void 0:e.conditions)==null?void 0:o.conditions))},V=e=>{var s,p;let o={...a};o.set=(s=e==null?void 0:e.conditions)==null?void 0:s.set,o.set_value=(p=e==null?void 0:e.conditions)==null?void 0:p.set_value,N(o)},_=e=>{g(e!=null&&e.bonuses.length?Object.values(e==null?void 0:e.bonuses):[])},I=e=>{if(e){let o=e.split("-");return`${o[2]}/${o[1]}/${o[0]}`}};return G?r(F,{}):u(J.Fragment,{children:[u("div",{className:c.breadcrumb,children:[u(S,{children:[r(S.Item,{children:"Marketing"}),r(S.Item,{children:r("a",{href:"",children:"Edit Catalog Promotion"})})]}),r(X,{onClick:M,type:"primary",children:"Save changes"})]}),u("div",{className:c.container,children:[r("div",{className:c.tabWrapper,children:["General","Conditions","Bonuses"].map((e,o)=>r("div",{className:Q(c.tab,e===d?c.bgColor:null),onClick:()=>j(e),children:e},o))}),r("div",{className:c.tabcontain,children:E()})]})]})};export{po as default};
