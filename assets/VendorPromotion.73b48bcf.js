import{r as n,ao as k,b as r,a$ as F,j as u,X as J,v as Q}from"./index.4f23c09f.js";import{s as c}from"./Promotion.module.b34b1af2.js";import q from"./General.f6516eff.js";import{g as z,h as L}from"./PromotionApi.acc6f084.js";import R from"./Conditions.0b6bc886.js";import W from"./Bonuses.9744e2a8.js";import{B as S}from"./Breadcrumb.1fc5972d.js";import{B as X}from"./button.0e0bb488.js";import{m as Y}from"./index.ed593c0f.js";import"./quill.snow.aca1e919.js";import"./isEqual.5405dd52.js";import"./ImageUploaderForPromotion.887a7f02.js";import"./index.87e32118.js";import"./index.7a8128c4.js";import"./motion.9212238f.js";import"./useMergedState.a9c803d6.js";import"./collapse.7fea9198.js";import"./LoadingOutlined.ad18cc7b.js";import"./row.dbcb11e5.js";import"./useFlexGapSupport.3166aa6c.js";import"./responsiveObserve.16c01648.js";import"./index.9a953548.js";import"./pickAttrs.08767335.js";import"./useForceUpdate.f84be2ca.js";import"./EyeOutlined.ac35e31d.js";import"./progress.cd81fb2e.js";import"./CheckOutlined.a5fb0c39.js";import"./index.2716beec.js";import"./render.a21f8e67.js";import"./index.ba3281eb.js";import"./PlusOutlined.1693ec3e.js";import"./index.334a4467.js";import"./index.2687a7e4.js";import"./Compact.8d51645f.js";import"./TextArea.5556322f.js";import"./index.04eab99a.js";import"./statusUtils.c3240a4a.js";import"./SearchOutlined.19f92cba.js";import"./useNotification.ddc3cd5c.js";import"./apiConfig.6fee151b.js";import"./axios.0a901153.js";import"./config.93562c2e.js";import"./useMutation.esm.62dcf3b9.js";import"./utils.esm.958af8f4.js";import"./useInfiniteQuery.esm.7b143079.js";import"./useQuery.esm.48f464b8.js";import"./index.esm.476cd3ce.js";import"./Table.7ae9acac.js";import"./styleChecker.c75b564a.js";import"./css.d6e3059f.js";import"./index.421566c6.js";import"./Overflow.1804b708.js";import"./DownOutlined.72f23fd5.js";import"./PurePanel.01378a58.js";import"./Pagination.61534547.js";import"./LeftOutlined.04d83dae.js";import"./RightOutlined.dab7e2a3.js";import"./index.9fb36eb2.js";import"./index.48a55223.js";import"./dropdown.c5450427.js";import"./Dropdown.af716b86.js";import"./index.c1ec313f.js";import"./apicall.3416e5db.js";import"./useDebounce.06723c1e.js";const po=({data:t})=>{const[d,j]=n.exports.useState("General"),[C,g]=n.exports.useState([]),[D,x]=n.exports.useState([]),[f,w]=n.exports.useState(""),[h,$]=n.exports.useState({image_id:"",pair_id:"",object_type:"promotion"}),[m,b]=n.exports.useState({zone:"catalog",name:"",detailed_description:"",short_description:"",from_date:"",to_date:"",priority:0,stop_other_rules:"N",status:"A"}),[a,N]=n.exports.useState({set:"all",set_value:1}),{isLoading:G,mutate:T,isError:H}=z(),{mutateAsync:P}=L(),A=k(),E=()=>{switch(d){case"General":return r(q,{image:f,setImage:w,generalData:m,setGeneralData:b,data:t,deleteImage:h,setDeleteImage:$});case"Conditions":return r(R,{conditions:D,setConditions:x,conditionValues:a,setConditionValues:N});default:return r(W,{bonuses:C,setBonuses:g})}},B=e=>{const o=new Date(parseInt(e)*1e3);var s=String(o.getUTCMonth()+1).padStart(2,"0"),p=String(o.getUTCDate()).padStart(2,"0"),l=o.getUTCFullYear();return`${l}-${s}-${p}`},M=()=>{try{if(m.name){const e=new FormData;let o={promo_main_image_data:{0:{pair_id:"",type:"M",object_id:"0",image_alt:""}},file_promo_main_image_icon:{0:"promo_main"},type_promo_main_image_icon:{0:"local"},is_high_res_promo_main_image_icon:{0:"N"}},s=D.reduce((i,v,y)=>(i[y+1]={...v},i),{}),p=C.reduce((i,v,y)=>(i[y]={...v},i),{}),l={promotion_id:t==null?void 0:t.promotion_id,promotion_data:{...m,from_date:I(m.from_date),to_date:I(m.to_date),bonuses:{...p},conditions:{...a,conditions:{...s}}}};f&&(e.append("file",f),l={...l,...o}),e.append("promotion_data",JSON.stringify(l)),h.image_id&&P(h,{onSuccess:i=>console.log("image deleted successfully")}),T(e,{onSuccess:i=>{A.invalidateQueries(["single_promotion",t==null?void 0:t.promotion_id])},onError:i=>{console.log("error on updating promotion, ",i)}})}else Y.error("Name is necessary to create a promotion.")}catch(e){console.log(e.message)}};n.exports.useEffect(()=>{O(t),U(t),V(t),_(t)},[t]);const O=e=>{let o={...m};o.name=e==null?void 0:e.name,o.detailed_description=e==null?void 0:e.detailed_description,o.short_description=e==null?void 0:e.short_description,o.from_date=B(e==null?void 0:e.from_date),o.to_date=B(e==null?void 0:e.to_date),o.priority=e==null?void 0:e.priority,o.stop_other_rules=e==null?void 0:e.stop_other_rules,b(o)},U=e=>{var o;x(e!=null&&e.conditions.length?[]:Object.values((o=e==null?void 0:e.conditions)==null?void 0:o.conditions))},V=e=>{var s,p;let o={...a};o.set=(s=e==null?void 0:e.conditions)==null?void 0:s.set,o.set_value=(p=e==null?void 0:e.conditions)==null?void 0:p.set_value,N(o)},_=e=>{g(e!=null&&e.bonuses.length?Object.values(e==null?void 0:e.bonuses):[])},I=e=>{if(e){let o=e.split("-");return`${o[2]}/${o[1]}/${o[0]}`}};return G?r(F,{}):u(J.Fragment,{children:[u("div",{className:c.breadcrumb,children:[u(S,{children:[r(S.Item,{children:"Marketing"}),r(S.Item,{children:r("a",{href:"",children:"Edit Catalog Promotion"})})]}),r(X,{onClick:M,type:"primary",children:"Save changes"})]}),u("div",{className:c.container,children:[r("div",{className:c.tabWrapper,children:["General","Conditions","Bonuses"].map((e,o)=>r("div",{className:Q(c.tab,e===d?c.bgColor:null),onClick:()=>j(e),children:e},o))}),r("div",{className:c.tabcontain,children:E()})]})]})};export{po as default};
